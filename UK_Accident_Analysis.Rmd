---
title: 'Road Accidents in the UK: a descriptive analysis in R of the distribution of accidents'
author: "Giorgio Dramis"
date: "2024-02-24"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

# Introduction

Road accidents have significant consequences for people's safety and socio-economic costs, especially in large metropolitan areas. Data analysis in this field can be fundamental to understanding the main triggering factors, identifying high-risk areas and, with the use of machine learning, developing effective strategies to prevent future accidents and improve road safety.

According to data from the Department of Transportation, in 2014 the largest number of road accidents in the United Kingdom were caused by the driver. Inexperience and improper behavior are the major causes. Followed by distraction, which caused 1 in 5 accidents, while infrastructure is blamed for about 17% of accidents.

This study, based on a dataset that collects accident data in the UK over a period of almost ten years, aims to provide an exhaustive description of the phenomenon of road accidents, exposing the most typical circumstances in which they occur, such as weather conditions, road surface conditions, time of day.

# Dataset Description

As mentioned earlier, the __[dataset](https://www.kaggle.com/code/piyushkr303/accident-severity-prediction-98-5-accuracy/input)__ used for the following analysis is a 9-year record of road accidents, from 2005 to 2014, for a total of just over one and a half million observations.

```{r inport, echo=TRUE, message=FALSE, warning=FALSE}
source <- read.csv("UK_Accident.csv")
```

The original dataset consists of 33 variables, described below:

_Numerical variables:_

* X: a progressive, unique for each observation;
* Accident Index: numerical code identifying each observation;
* Location Easting OSGR: the acronym stands for "Ordnance Survey Grid Reference", a geographic reference system used in the United Kingdom to identify the position of a point on the Earth's surface. This variable identifies the East coordinate according to this system;
* Location Nothing OSGR: the North coordinate analogous to the previous variable;
* Longitude: longitude coordinate;
* Latitude: latitude coordinate;
* Date: date of the accident;
* Year: exclusively the year of the accident;
* Police force: the police force related to the geographical area that intervenes on the accident;
* Number of vehicles: number of vehicles involved in the accident;
* Number of casualties: number of victims/injured involved in the accident;
* Day of the week: day of the week of the accident;
* Time: time of the accident;
* Local Authority District: identification code of the administrative subdivision of a county or region where the accident occurred;
* Local Authority Highway: identification code of the local authority responsible for the maintenance, safety and improvement of the road where the accident occurred. It includes road signs, paving, traffic management and other areas of competence;
* First road class: identification code of the type of road where the accident occurred. This category includes motorways, dual carriageways, urban main roads, etc;
* First road number: identification number of the accident road (First Road);
* Second road class: identification code of the type of road where the accident occurred. This category includes single carriageway roads, secondary urban roads, neighborhood roads, etc;
* Second road number: identification number of the accident road (Second Road);
* Speed limit: speed limit of the road where the accident occurred;

_Categorical variables:_

* Accident severity: severity of the accident, on a scale from 1 (most serious) to 3 (least serious);
* Road type: where the accident occurred - single carriageway, dual carriageway, roundabout, etc;
* Junction control: type of traffic management in the case of intersections - police officer, traffic light, none, etc;
* Pedestrian crossing human control: type of pedestrian crossing management where applicable - authorized person, with signs, none, etc;
* Pedestrian crossing physical facilities: type of infrastructure to allow pedestrian crossing where applicable - traffic light, pedestrian crossing, none, etc;
* Light conditions: visibility conditions - daylight, darkness with streetlights, dark, etc;
* Weather conditions: weather conditions - rain, fog, strong winds, etc;
* Road surface conditions: road surface conditions - wet, icy, none, etc;
* Special conditions at site: special conditions at the site - malfunctioning traffic light, roadworks along the carriageway, mud, etc;
* Carriageway hazards: obstacles on the carriageway - animal crossing, vehicle obstructing the passage, involvement in a chain accident, etc;
* Urban or rural area: binary variable indicating whether the road where the accident occurred is part of an urban or extra-urban area;
* "Did police officer attend scene of accident?": binary variable indicating whether the road accident required the intervention of the police or not;
* LSOA of accident location: the acronym stands for 'Lower Layer Super Output Area', numerical code identifying the geographical unit according to a subdivision characteristic of the National Statistics and Registration Service in the United Kingdom, to publish statistical data;

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
#intall.packages("webshot")
#intall.packages("webshot2")
#install.packages("readxl")
#install.packages("dplyr")
#install.packages("caret")
#install.packages("plotly")
#install.packages("extrafont")
#install.packages("lubridate")
#install.packages("sf")
#install.packages("ggmap")
#install.packages("ggplot2")
#install.packages("scales")
#install.packages("treemapify")
#install.packages("magick")
#install.packages("gganimate")
#install.packages("tidyr")
#install.packages("RColorBrewer")
#install.packages("superheat")

library(webshot)
library(webshot2)
library(readxl)
library(gganimate)
library(RColorBrewer)
library(magick)
library(treemapify)
library(extrafont)
library(caret)
library(dplyr)
library(lubridate)
library(plotly)
library(ggmap)
library(ggplot2)
library(sf)
library(scales)
library(tidyr)
library(superheat)
```

___

## Data Pre-processing and Dataset Cleaning

Before proceeding with the visualization of explanatory graphs, or any other analysis, it is necessary to perform operations to correct imperfections in the data and make it homogeneous.

```{r preprocessing, echo=FALSE, message=FALSE, warning=FALSE}
valori_null <- is.na(source)

source_null <- source[rowSums(valori_null)>0, ] # number of null values equal to 101, irrelevant compared to the dataset size

data <- na.omit(source) # removal from the dataset

# from the date column, only the month is extracted. Another column is created with this information, and the original date column is removed.  
data$Date <- as.Date(data$Date, format = "%d/%m/%Y") #conversione del formato in data
data$Month <- month(data$Date)

# column removal
data <- data[ ,-c(1:4,11,14,16,17,21,22,31,32)]
dummy <- data
dummy <- dummy %>% relocate(Day_of_Week, .after = "Month")
dummy <- dummy %>% relocate(Time, .after = "Day_of_Week")
data <- dummy

# modification to the time column: only the hours are kept, and the minutes are removed.  
data$Time <- substr(data$Time, 1, 2)

# removal of duplicates
duplicati <- data[duplicated(data) | duplicated(data, fromLast = TRUE), ]

# only the first occurrence of each duplicate value in the column is kept.  
data <- data[!duplicated(data), ]
data_backup <- data

#removal from the environment
remove(duplicati)
remove(source_null)
remove(valori_null)
remove(dummy)

```

First, a count is performed of the observations that contain null or Na values in the cells of any variable. These are found to be significantly lower than the total number of rows (101), so they are removed from the dataset.

Following the removal of rows, it is also convenient to perform a reduction on the columns. There are redundant attributes or information that are not useful for the analysis, such as the different coordinates belonging to different systems or the unique progressive codes. In this context, the following changes are made:

* X and Accident Index are removed;
* Location EASTing OSGR and Location NORTHing OSGR are redundant, as latitude and longitude are available;
* Similar reasoning applies to LSOA of Accident Location: it is another way of locating the accidents;
* The variable concerning the presence of a police officer at the accident scene is ambiguous when compared to the variable 'Police Force'. It is removed;
* The variables describing the type of road, First road class and First road number (as well as the corresponding Second road class and Second road number) are marginal to the analysis conducted. They are removed;
* Local Authority District and Local Authority Highway go hand in hand, with a high correlation, so the first one is eliminated;
* The information regarding the month of the accident is extracted from the column containing the full date and transferred to another variable "Month". The date, in string format, is deleted;
* The time of the accident is truncated to remove the minutes.

All remaining variables have been subjected to screening for any duplicates. In the following sections, further checks are shown to explain their behavior and link it to the incidence of road accidents.  
___

## Relationships between variables: correlation matrix

In search of 'hidden' patterns and trends within the data, the correlation matrix is often used, as it provides valuable insights into the relationships between variables. Through this tool, it is intuitively easy to understand which variables are correlated and to what extent, thus providing a solid foundation for making informed decisions.

For the purposes of this analysis, the main goal of this step is to select the most relevant variables to include in the subsequent data exploration, but generally, visualizing the correlations helps identify potential multicollinearity issues. These, in fact, negatively affect the accuracy of predictive models when implementing classification or regression algorithms.

In summary, analyzing correlation matrices is an essential step in data analysis as it provides a clear overview of the relationships between variables and guides the decision-making process more effectively and accurately.

Here are the strongest correlations within the dataset:

```{r correlation, echo=FALSE, message=FALSE, warning=FALSE}
encode_labels <- function(column) {
  unique_labels <- unique(column)
  labels_to_numbers <- as.numeric(factor(column, levels = unique_labels))
  return(labels_to_numbers)
}

# to generate the correlation matrix, a temporary dataset created specifically for this purpose is used, containing numeric variables.

data_temp <- data %>% mutate_if(is.character, encode_labels)
cormatrix <- cor(data_temp)

high_correlations <- which(abs(cormatrix) > 0.49 & cormatrix != 1, arr.ind = TRUE)

print("Pairs of variables with a correlation above 0.49:")
for (i in 1:nrow(high_correlations)) {
  row_index <- high_correlations[i, 1]
  col_index <- high_correlations[i, 2]
  correlation_value <- cormatrix[row_index, col_index]

  variable1 <- colnames(cormatrix)[row_index]
  variable2 <- colnames(cormatrix)[col_index]
  
  cat(sprintf("Pairs of variables: %s, %s - Correlazione: %.2f\n", variable1, variable2, correlation_value))
}
```

To display them graphically, a Heatmap can be used:

```{r matrix, echo=TRUE, message=FALSE, warning=FALSE}

# Correlation Heatmap
heatmap(cormatrix, 
        col = colorRampPalette(c("blue", "white", "red"))(100),
        main = "Heatmap of the Correlation Matrix",
        margins = c(9, 9),
        cexRow = 1, cexCol = 1)
```

There is not much variety in strong correlations. The first one, between the speed limit and the binary variable indicating whether the road is urban or extra-urban, is quite self-explanatory: speed limits tend to be quite different between the two categories. Meanwhile, the higher correlation between Local Authority Highway and Police Force is explained by the fact that both variables refer to the same geographical area.

However, the fact that correlations do not imply causality does not discourage the analysis from searching for significant patterns. Therefore, we proceed with the data visualization section.

___

# Data visualization on the variables

In this section, the remaining variables in the dataset are subjected to visual analysis through histograms, tree maps, geographic maps, etc. In particular, note that in all histograms, darker colors correspond to a higher volume of occurrences.

___

## Police force

```{r police force, echo=FALSE, message=FALSE, warning=FALSE}

bar_policeforce <- plot_ly(data = as.data.frame(table(data$Police_Force)),
                           x = ~Var1, y = ~Freq,
                           type = "bar",
                           marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Squadra", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_policeforce
```

For this first variable, there is a prevalence of interventions in case of accidents by the police force associated conventionally with the value 1. This information will be useful for the analysis later on, when it will be narrowed down to the area of competence related to team 1.

___

## Number of vehicles involved

```{r number vehicles, echo=FALSE, message=FALSE, warning=FALSE}

bar_numberofvehicles <- plot_ly(data = as.data.frame(table(data$Number_of_Vehicles)),
                                x = ~Var1, y = ~Freq,
                                type = "bar",
                                marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Veicoli coinvolti", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofvehicles
```

Looking at the graph, it is immediately evident that beyond five vehicles involved in the incident, the observations become increasingly sparse. For completeness, an upper bound is set at 7 vehicles (to keep only the values of the variable with more than 500 observations), and the remaining, being irrelevant in volume, are considered outliers and removed from the dataset. Below is the updated histogram:

```{r number vehicles 2, echo=FALSE, message=FALSE, warning=FALSE}

data <- data[data$Number_of_Vehicles <7, ]

bar_numberofvehicles <- plot_ly(data = as.data.frame(table(data$Number_of_Vehicles)),
                                x = ~Var1, y = ~Freq,
                                type = "bar",
                                marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Veicoli coinvolti", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofvehicles
```
___

## Number of injuries/victims

```{r casualities, echo=FALSE, message=FALSE, warning=FALSE}
bar_numberofcasualities <- plot_ly(data = as.data.frame(table(data$Number_of_Casualties)),
                                   x = ~Var1, y = ~Freq,
                                   type = "bar",
                                   marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Feriti/vittime", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofcasualities
```

In the case of people who have suffered harm in the accident, the result is similar to the previous case. Here too, observations (outliers) with more than 8 injuries or victims are removed.

```{r casualities 2, echo=FALSE, message=FALSE, warning=FALSE}

data <- data[data$Number_of_Casualties <8, ]

bar_numberofcasualities <- plot_ly(data = as.data.frame(table(data$Number_of_Casualties)),
                                   x = ~Var1, y = ~Freq,
                                   type = "bar",
                                   marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Feriti/vittime", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofcasualities
```
___

## Year of the accident

```{r year, echo=FALSE, message=FALSE, warning=FALSE}
bar_year <- plot_ly(data = as.data.frame(table(data$Year)),
                    x = ~Var1, y = ~Freq,
                    type = "bar",
                    marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Anno", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_year
```

A decreasing trend in the number of road accidents over the years can be observed, except for a small reversal between 2013 and 2014. This phenomenon will also be analyzed in more detail later.

___

## Day of the week

```{r weekday, echo=FALSE, message=FALSE, warning=FALSE}
bar_dayoftheweek <- plot_ly(data = as.data.frame(table(data$Day_of_Week)),
                            x = ~Var1, y = ~Freq,
                            type = "bar",
                            marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Giorno", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, 
                 tickvals = 1:7,
                 ticktext = c("Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato")),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_dayoftheweek
```

Contrary to what one might expect, over the nine years, the number of accidents occurring between Saturday and Sunday is lower than the rest of the week, with a peak on Friday that is about 80,000 observations higher than on Sunday, for example.

It is believed that this may be related to weekday traffic, which has a greater impact on the danger of British roads compared to a potential weekend nightlife.

In any case, it is important to remember that this histogram refers exclusively to the number of accidents and does not consider their severity or the number of vehicles and people involved. Later in the analysis, interesting dynamics will be shown when combining these attributes of the observations.

___

## Time of the accident

```{r time, echo=FALSE, message=FALSE, warning=FALSE}
data$Time <- as.integer(data$Time)

bar_time <- plot_ly(data = as.data.frame(table(data$Time)),
                    x = ~Var1, y = ~Freq,
                    type = "bar",
                    marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Ora", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10,
                 tickvals = 0:23),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_time
```

Another interesting graph, as it highlights how accidents occur more frequently during office working hours: at 8:00 when the work, school, and academic day generally begins, and then again between 15:00 and 17:00 as it concludes. Additionally, it is well known that in the UK, dinner time is earlier than the Mediterranean standard: this component may further explain why occurrences decrease after 18:00.

Note how the frequency of accidents during nighttime hours is surprisingly low. A pre-observation assumption might have led one to imagine that, with the higher probability of altered psychological or physical conditions and/or drowsiness due to late hours or night shifts, this would actually be the time with the highest number of accidents.

A potential explanation for this reality presented by the data is that in the UK, climate and social habits lead Britons to spend their free time mainly indoors or in enclosed places; combined with the earlier eating culture mentioned earlier, this dynamic might explain the low traffic during late night hours.

___

## Severity of the accident

```{r severity, echo=FALSE, message=FALSE, warning=FALSE}
bar_accidentseverity <- plot_ly(data = as.data.frame(table(data$Accident_Severity)),
                                x = ~Var1, y = ~Freq,
                                type = "bar",
                                marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Gravità", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_accidentseverity
```

Regarding the severity of the accidents, it is evident that the vast majority of them fall into the third category (lowest severity).

___

## Type of road

Before even visualizing the histogram of road type distribution, the presence of a small percentage of uncategorized observations (value "Unknown") stands out. These are removed, and then the graph is observed.

```{r road type, echo=FALSE, message=FALSE, warning=FALSE}

table(data$Road_Type)

data <- data[data$Road_Type != "Unknown", ]

bar_roadtype <- plot_ly(data = as.data.frame(table(data$Road_Type)),
                        x = ~Var1, y = ~Freq,
                        type = "bar",
                        marker = list(color = colorRampPalette(c("#0088ff", "#120a8f"))(6))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_roadtype
```

# The majority of accidents occurred on single-lane roads (two lanes with two-way traffic within a single carriageway).

___

## Speed limit

```{r speed limit, echo=FALSE, message=FALSE, warning=FALSE}
bar_speed <- plot_ly(data = as.data.frame(table(data$Speed_limit)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Limite [miglia/h]", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_speed
```

The modification made to this variable was to remove occurrences with speed limits lower than 20 miles per hour, as they are of negligible volume for the analysis. The graph without outliers:

```{r speed limit 2, echo=FALSE, message=FALSE, warning=FALSE}

data <- data[data$Speed_limit >20, ] #vengono eliminate le poche occorrenze di incidenti avvenuti in strade con limite di velocità inferiore o uguale al 20

bar_speed <- plot_ly(data = as.data.frame(table(data$Speed_limit)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Limite [miglia/h]", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_speed
```

___

## Traffic management

```{r junction control, echo=FALSE, message=FALSE, warning=FALSE}
bar_junction <- plot_ly(data = as.data.frame(table(data$Junction_Control)),
                        x = ~Var1, y = ~Freq,
                        type = "bar",
                        marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_junction
```

The two predominant categories are the absence of control (no signs or traffic officers managing traffic) or cases where this variable does not apply (accidents not caused by intersections). Another, more graphic method of visualizing the distribution of cases based on traffic management is through a tree map.

```{r junction control 2, echo=FALSE, message=FALSE, warning=FALSE}

plotdata <- data %>%
  count(Junction_Control)

ggplot(plotdata, 
       aes(fill = Junction_Control, 
           area = n, 
           label = Junction_Control)) +
  geom_treemap() + 
  geom_treemap_text(colour = "white", 
                    place = "centre") +
  labs(title = "") +
  theme(legend.position = "none")
```

___

## Pedestrian crossing management

```{r pedestrian human control, echo=FALSE, message=FALSE, warning=FALSE}
bar_pedControl <- plot_ly(data = as.data.frame(table(data$Pedestrian_Crossing.Human_Control)),
                          x = ~Var1, y = ~Freq,
                          type = "bar",
                          marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_pedControl

data <- data[ ,-11]
```

From the graph regarding the management (and also the presence or absence) of a pedestrian crossing, it is clear that the variable is irrelevant, as more than 99% of the observations fall into the last category: where no pedestrian crossing was present within 50 meters of the accident site. This attribute is removed from the dataset.

___

## Type of pedestrian crossing

```{r facility pedestrian crossing, echo=FALSE, message=FALSE, warning=FALSE}
bar_pedFacility <- plot_ly(data = as.data.frame(table(data$Pedestrian_Crossing.Physical_Facilities)),
                           x = ~Var1, y = ~Freq,
                           type = "bar",
                           marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_pedFacility

data <- data[ ,-11]
```
Similarly to the previous consideration regarding the variable related to pedestrian crossing management, here too, the majority of observations fall into the category of absence of a pedestrian crossing within 50 meters. This variable is also removed.

___

## Visibility conditions

```{r light conditions, echo=FALSE, message=FALSE, warning=FALSE}
bar_light <- plot_ly(data = as.data.frame(table(data$Light_Conditions)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_light
```

Given the limited observations in some of the categories shown in the graph, simplifications are made:

* The "Street Lighting Unknown" category is removed: it provides no additional information;
* The categories related to darkness, whether caused by streetlights being off or by the absence of artificial light, are merged;
* The remaining categories are renamed.

```{r light conditions 2, echo=TRUE, message=FALSE, warning=FALSE}

table(data$Light_Conditions)

data <- data[data$Light_Conditions != "Darkness: Street lighting unknown", ]

data$Light_Conditions[data$Light_Conditions == "Darkness: Street lights present but unlit"] <- "Darkeness: No street lighting"
data$Light_Conditions[data$Light_Conditions == "Darkeness: No street lighting"] <- "Night: Complete darkness"
data$Light_Conditions[data$Light_Conditions == "Darkness: Street lights present and lit"] <- "Night: Street lights lit"
data$Light_Conditions[data$Light_Conditions == "Daylight: Street light present"] <- "Daylight"
```

Following these modifications, the new histogram:

```{r light conditions 3, echo=FALSE, message=FALSE, warning=FALSE}
bar_light <- plot_ly(data = as.data.frame(table(data$Light_Conditions)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_light
```

___

## Weather conditions

Before even visualizing the histogram of weather condition distribution, the presence of a small percentage of uncategorized observations (value "Unknown") stands out. These are removed, and then the graph is observed.

```{r weather, echo=FALSE, message=FALSE, warning=FALSE}

table(data$Weather_Conditions)

# Removal of "Unknown" category

data <- data[data$Weather_Conditions != "Unknown", ]

bar_weather <- plot_ly(data = as.data.frame(table(data$Weather_Conditions)),
                       x = ~Var1, y = ~Freq,
                       type = "bar",
                       marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_weather
```

Similar modifications are made to the previous case:

```{r weather2, echo=TRUE, message=FALSE, warning=FALSE}

# merging of rain categories (with & without wind)
data$Weather_Conditions[data$Weather_Conditions == "Raining with high winds"] <- "Rain"
data$Weather_Conditions[data$Weather_Conditions == "Raining without high winds"] <- "Rain"
data$Weather_Conditions[data$Weather_Conditions == "Fine without high winds"] <- "Fine"

# all remaining categories merged into "other"
data$Weather_Conditions[data$Weather_Conditions != "Rain" & data$Weather_Conditions != "Fine"] <- "Other"

table(data$Weather_Conditions)
```

```{r weather3, echo=FALSE, message=FALSE, warning=FALSE}

bar_weather <- plot_ly(data = as.data.frame(table(data$Weather_Conditions)),
                       x = ~Var1, y = ~Freq,
                       type = "bar",
                       marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_weather
```

In case one suspects that, in a country stereotypically recognized as one of the rainiest in Europe, there are so few cases of accidents during rain, it is important to note that the "Fine" category should not be understood in line with common imagination.

"Fine" could indeed include light rain conditions, as it refers to road conditions: light wind or overcast sky, which do not significantly impair driving abilities, would fall into this category.

___

## Road surface conditions

```{r pavement, echo=FALSE, message=FALSE, warning=FALSE}
bar_drywet <- plot_ly(data = as.data.frame(table(data$Road_Surface_Conditions)),
                      x = ~Var1, y = ~Freq,
                      type = "bar",
                      marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_drywet
```

Similar modifications are made here as in the previous case:

```{r pavement2, echo=TRUE, message=FALSE, warning=FALSE}

# "Normal" is removed. "Flood" and "Snow" are added to the "Wet/Damp" category.
data <- data[data$Road_Surface_Conditions != "Normal", ]
data$Road_Surface_Conditions[data$Road_Surface_Conditions %in% c("Flood (Over 3cm of water)", "Snow")] <- "Wet/Damp"
```

The new histogram:

```{r pavement3, echo=FALSE, message=FALSE, warning=FALSE}

bar_drywet <- plot_ly(data = as.data.frame(table(data$Road_Surface_Conditions)),
                      x = ~Var1, y = ~Freq,
                      type = "bar",
                      marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_drywet
```

___

## Special conditions

```{r special, echo=FALSE, message=FALSE, warning=FALSE}
bar_special <- plot_ly(data = as.data.frame(table(data$Special_Conditions_at_Site)),
                       x = ~Var1, y = ~Freq,
                       type = "bar",
                       marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_special

# The "none" category constitutes approximately 97% of the total. Removal of the column:
data <- data[,-14]
```

There is little variability in the data, as the "None" category accounts for about 97% of the total occurrences. The variable is removed.

___

## Obstacles on the roadway

```{r carriageway, echo=FALSE, message=FALSE, warning=FALSE}
bar_carriage <- plot_ly(data = as.data.frame(table(data$Carriageway_Hazards)),
                        x = ~Var1, y = ~Freq,
                        type = "bar",
                        marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_carriage

data <- data[,-14]
```

A similar discussion applies to the variable indicating whether there are obstacles or other unforeseen dangers on the roadway. It is removed.

___

## Urban vs. Rural

This variable has three categories. However, the third category contains only about thirty occurrences, so it is removed from the dataset.

```{r urban, echo=FALSE, message=FALSE, warning=FALSE}
data <- data[data$Urban_or_Rural_Area != 3, ]

bar_urban <- plot_ly(data = as.data.frame(table(data$Urban_or_Rural_Area)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Tipologia di strada", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_urban
```

___

## Road safety district

```{r authority, echo=FALSE, message=FALSE, warning=FALSE}
bar_district <- plot_ly(data = as.data.frame(table(data$Local_Authority_.Highway.)),
                        x = ~Var1, y = ~Freq,
                        type = "bar",
                        marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_district
```

Given the coordinates of where the accidents occurred, a map of Great Britain could provide a clearer idea than this histogram, thus making this variable redundant.

___
___

# Data visualization: more in-depth analysis
## Geographical maps of Great Britain

In the following section, various geographical maps of Great Britain will be analyzed, with a particular focus on the Greater London area. The analysis of data on geographical maps is an essential practice for understanding and interpreting spatial relationships within the data. Mapping road accidents could be an excellent strategy to identify potential patterns, trends, and distributions.

This type of analysis offers the opportunity to explore environmental or infrastructural characteristics related to accidents, assess the impact of road safety interventions, and potentially provide decision-makers with tools to plan targeted interventions to improve road safety.

```{r map1, echo=FALSE, message=FALSE, warning=FALSE}

register_google("AIzaSyA9mvRjStf4XhW0Y98-TAchzmA7KKyaTNE")

UK_map <- get_map(location = c(lon = -2.3180, lat = 53.501014), 
                  zoom = 6, 
                  maptype = "terrain")

ggmap(UK_map)
```

# The following three maps reflect the density of accidents distributed across the entire national territory. Specifically, referring to the three levels of severity in which all accidents in the dataset are classified, the maps will show:

* In <span style="color:#e15602;">orange</span>, the density of low severity accidents
* In <span style="color:#df0602;">red</span>, the density of medium severity accidents
* In <span style="color:#780000;">burgundy</span>, the density of high severity accidents

```{r map2, echo=TRUE, message=FALSE, warning=FALSE}

map_UKseverity3 <- ggmap(UK_map) +
  stat_density_2d(data = subset(data, data$Accident_Severity == 3), aes(x = Longitude, y = Latitude), geom = "path", color = "#e15602", size = 1, n = 100, bins = 30) +
  ggtitle("Densità per gravità 3")

map_UKseverity3

map_UKseverity2 <- ggmap(UK_map) +
  stat_density_2d(data = subset(data, data$Accident_Severity == 2), aes(x = Longitude, y = Latitude), geom = "path", color = "#df0602", size = 1, n = 300, bins = 30) + 
  ggtitle("Densità per gravità 2")

map_UKseverity2

map_UKseverity1 <- ggmap(UK_map) +
  stat_density_2d(data = subset(data, data$Accident_Severity == 1), aes(x = Longitude, y = Latitude), geom = "path", color = "#780000", size = 1, n = 500, bins = 30) +
  ggtitle("Densità per gravità 1")

map_UKseverity1
```

It is evident that, regardless of the severity level, accidents are concentrated mainly in urban areas. London, in particular, seems to be the metropolitan area with the highest accident density. The hypothesis arises that there might be a connection between Police Force 1, which stood out in the histogram during the variable analysis, and the city of London.

```{r map3, echo=TRUE, message=FALSE, warning=FALSE}

bar_policeforce

# identify on the map which area refers to Police Force 1:
ggmap(UK_map) + geom_point(data = subset(data, data$Police_Force == 1), aes(x = Longitude, y = Latitude), color = "red", size = 0.5)

```

The map is unequivocal: the area where the 'Police Force' conventionally associated with the value 1 operates is the British capital. This is consistent with the density graphs just shown.  
Therefore, we proceed with a more detailed analysis focused solely on the city of London.

___

## Geographic maps of London.

```{r london, echo=TRUE, message=FALSE, warning=FALSE}
data_london <- subset(data, data$Latitude >= 51.15 & data$Latitude <= 51.8 & data$Longitude >= -0.5 & data$Longitude <= 0.5)
dim(data_london)
```

Given the size of the dataset, it would be advisable to attempt to further reduce the observed occurrences, or the resulting geographic map will be illegible. One option is to limit the data to be displayed to a specific time range. The distribution of incidents year by year is observed with a histogram:

```{r london2, echo=FALSE, message=FALSE, warning=FALSE}
bar_year <- plot_ly(data = as.data.frame(table(data_london$Year)),
                    x = ~Var1, y = ~Freq,
                    type = "bar",
                    marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    title = list(text = "Incidenti annuali nella città di Londra", font = list(color = 'black', family = 'Calibri', size = 26, weight = 'bold')),
    xaxis = list(title = list(text = "Anno", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_year
```

The number of incidents has remained fairly similar over the years, without deviating significantly from the decade's average. Unlike the trend observed across the entire UK territory, in the case of London, a decreasing trend is not evident.  

In search of a pattern, it is decided to isolate incidents of severity 1 and 2:

```{r london3, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(subset(data_london, Accident_Severity != 3), 
       aes(x = as.factor(Year), 
           fill = as.factor(Accident_Severity))) + 
  geom_bar(position = "stack") +
  labs(x="Anno", y = "Osservazioni", title = "Andamento degli incidenti di gravità 1 & 2", fill = "Gravità")
```

By isolating the most severe incidents, a more evident decreasing trend has emerged. Considering the slight increase recorded between 2013 and 2014 prior to this selection, it can be deduced that the incidents that increased were those of lower severity (category 3, excluded from this latest graph).  

Following this, we consider the last year of observations (2014) to conduct the analysis on London with a focus on the most severe incidents (1 & 2).  

The first comparison to be made involves the variable of the number of vehicles involved in the accident.

```{r london4, echo=FALSE, message=FALSE, warning=FALSE}
data_london2014 <- subset(data_london, data_london$Year > 2013 & data_london$Accident_Severity != 3)

# si visualizza l'istogramma degli incidenti per numero di veicoli coinvolti

bar_numberofvehiclesln2014 <- plot_ly(data = as.data.frame(table(data_london2014$Number_of_Vehicles)),
                                      x = ~Var1, y = ~Freq,
                                      type = "bar",
                                      marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Veicoli coinvolti", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofvehiclesln2014

# two and one vehicle are displayed on the map

London_map <- get_map(location = c(lon = -0.1180, lat = 51.5099), maptype = "roadmap", zoom = 10)

ggmap(London_map) + geom_point(data = subset(data_london2014, Number_of_Vehicles == 1), aes(x = Longitude, y = Latitude), color = "red", size = 0.5) + 
  geom_point(data = subset(data_london2014, Number_of_Vehicles == 2), aes(x = Longitude, y = Latitude), color = "blue", size = 0.5)
```

The two most populated categories (1 vehicle and 2 vehicles) are represented on the map in red and blue, respectively. However, the size of the dataset does not allow for an adequate visualization. It is decided to analyze the distribution of such incidents in time slots:

```{r london5, echo=FALSE, message=FALSE, warning=FALSE}

bar_Ltime <- plot_ly(data = as.data.frame(table(data_london2014$Time)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Ora", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10,
                 tickvals = 0:23),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_Ltime 
```

We proceed to create three time slots: morning, afternoon, and night.

```{r london6, echo=FALSE, message=FALSE, warning=FALSE}
data_london2014$day_split <- data_london2014$Time 

data_london2014$day_split[data_london2014$Time %in% c(21,22,23,0,1,2,3,4,5,6)] <- "night"
data_london2014$day_split[data_london2014$Time %in% c(7,8,9,10,11,12,13,14)] <- "morning"
data_london2014$day_split[data_london2014$Time %in% c(15:20)] <- "afternoon"

ggmap(London_map) + geom_point(data = subset(data_london2014, day_split == "morning"), aes(x = Longitude, y = Latitude), color = "red", size = 1) + ggtitle("Mattina")
ggmap(London_map) + geom_point(data = subset(data_london2014, day_split == "afternoon"), aes(x = Longitude, y = Latitude), color = "blue", size = 1) + ggtitle("Pomeriggio")
ggmap(London_map) + geom_point(data = subset(data_london2014, day_split == "night"), aes(x = Longitude, y = Latitude), color = "black", size = 1) + ggtitle("Notte")
```

Apart from a concentration of incidents in central London during the night, no particular information is detected. The map does not highlight clusters of incidents in the peripheral area, the urban center, or clear industrial zones depending on the time slot.  

It is therefore decided to investigate the months of the year 2014 using a histogram and a tree map.

```{r london7, echo=FALSE, message=FALSE, warning=FALSE}

bar_month <- plot_ly(data = as.data.frame(table(data$Month)),
                            x = ~Var1, y = ~Freq,
                            type = "bar",
                            marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    title = list(text = "Distribuzione mensile incidenti nel 2014", font = list(color = 'black', family = 'Calibri', size = 26, weight = 'bold')),
    xaxis = list(title = list(text = "Mese", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, 
                 tickvals = 1:12,
                 ticktext = c("Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre")),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_month

# Tree map:

plotdata <- data_london2014 %>%
  count(Month)

ggplot(plotdata, 
       aes(fill = Month, 
           area = n, 
           label = Month)) +
  geom_treemap() + 
  geom_treemap_text(colour = "white", 
                    place = "centre") +
  labs(title = "Incidenti per mese") +
  theme(legend.position = "none")

```

Even when examining the months, no significant pattern seems to emerge (contrary to what one might expect, considering the traffic during summer holidays or the Christmas period/other holidays).

___
___

# The case of London: relationships between variables

We proceed by analyzing the relationship between variables using percentage histograms: to conduct a meaningful analysis, it will be necessary to investigate specific cases one by one.

## Visibility and road surface conditions

```{r var1, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data_london2014, 
       aes(x = data_london2014$Light_Conditions,
           fill = data_london2014$Road_Surface_Conditions)) + 
  geom_bar(position = "fill") +
  labs(x="", y = "", title = "", fill = "Condizioni asfalto")+ 
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  scale_y_continuous(labels = scales::percent_format())
```

In conditions of good visibility, the data reflects that accidents predominantly occur on dry asphalt (with a minimal percentage on ice): this can also be explained by the daytime temperature (higher than at night), which allows ice to melt, while light helps the driver identify potential hazards related to wet asphalt.  

During the night, the percentages of accidents on wet or icy asphalt are more significant, especially in conditions of darkness without streetlights or other artificial lighting.
___

## Visibility and severity of the incident.

```{r var2, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data_london2014, 
       aes(x = as.factor(data_london2014$Accident_Severity),
           fill = data_london2014$Light_Conditions)) + 
  geom_bar(position = "fill") +
  labs(x="Gravità dell'incidente", y = "", title = "", fill = "Condizioni luce")+ 
  scale_y_continuous(labels = scales::percent_format())
```

Approximately 45% of severe incidents occur during nighttime hours. An interesting observation from the histogram is the surprisingly small impact of artificial light (such as streetlights) in preventing accidents. The portion of incidents that occurred in complete darkness, in fact, is not dramatically higher than those in conditions of artificial light—as if the presence or absence of streetlights does not significantly reduce the likelihood of accidents.  

An important distinction to make would be to identify exactly where these incidents occurred: it is possible that the majority of severe incidents took place on unlit roads.

```{r var3, echo=FALSE, message=FALSE, warning=FALSE}

London_map <- get_map(location = c(lon = -0.1180, lat = 51.5099), maptype = "roadmap", zoom = 9)

ggmap(London_map) +geom_point(data = subset(data_london2014, data_london2014$Light_Conditions == "Night: Complete darkness"), aes(x = Longitude, y = Latitude), color = "black", size = 1) 
```

As expected, all incidents that occurred in 'Complete Darkness' are located far from the urban center of London, which is presumed to be almost always well-lit.

___

## Severity of the incident and type of road.

```{r var4, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data_london2014, 
       aes(x = as.factor(Accident_Severity),
           fill = Road_Type)) + 
  geom_bar(position = "fill") +
  labs(x="Gravità dell'incidente", y = "", title = "", fill = "Tipo di strada")+ 
  scale_y_continuous(labels = scales::percent_format())
```

* Most accidents occur on "Single Carriageway" (roadway with a single lane in each direction). This is plausible if you imagine, for example, an overtaking maneuver which in these conditions is more dangerous due to exposure to head-on collisions;
* The second category is 'Dual Carriageway' - the risk of head-on collisions is almost excluded here, especially if there is a guardrail separating the two carriageways, but all other causes continue to exist (skidding, rear-end collisions, especially chain reactions since these are typical high-speed roads like highways);
* Self-explanatory that roundabouts are safer, given their objective of making traffic flow smoother;
* Also self-explanatory how there are few accidents occurring on one-way streets;
* The low volume of accidents on 'Slip Roads' (i.e. acceleration/deceleration lanes) can be explained by the fact that transit is limited to merging into the main road and is relatively quick.

To get some clues about which accident categories are characteristic of 'Single Carriageway' (whether head-on collisions, chain rear-end collisions, or other cases involving exclusively the crashed vehicle), we investigate the relationship between the number of vehicles involved and the road category:

```{r var5, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data_london2014, 
       aes(x = Number_of_Vehicles,
           fill = Road_Type)) + 
  geom_bar(position = "fill") +
  labs(x="Numero di veicoli", y = "Percentuali", title = "Relazione tra severità dell'incidente e il tipo di strada", fill = "Tipo di strada")+ 
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  scale_y_continuous(labels = scales::percent_format())
```

Occurrences on one-way streets and acceleration/deceleration lanes intuitively 'disappear' when more than 3 vehicles are involved. Regarding roundabouts, accident percentages continue to exist for up to 4 vehicles involved.

Finally, it's interesting to note how, apparently, as the number of involved vehicles increases, it becomes less likely for the accident to occur on a roadway with just two opposite lanes: the percentage of dual-lane roads becomes more significant.

To explore this further, an animation shows the increase in accident cases on dual-lane roads as the number of involved vehicles increases. These are examined in relation to the number of people involved.

(Of course, in PDF format, the ability to view the animation will be lost)

```{r var6, echo=TRUE, message=FALSE, warning=FALSE}
animazione <- ggplot(data, 
                     aes(x = data$Number_of_Casualties,
                         fill = as.factor(data$Road_Type))) + 
  geom_bar(position = "fill") +
  labs(x="Feriti/vittime coinvolti", y = "Percentuale di osservazioni", title = "Veicoli coinvolti: {frame_time}", fill = "Strada:")+ 
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  scale_y_continuous(labels = scales::percent_format()) +
  transition_time(Number_of_Vehicles) + ease_aes('linear')

animate(animazione, nframes = 100, duration = 10, fps = 5)
```

Here's the English translation:

The animation shows that as the number of vehicles involved (and injured/deceased people) increases, there is indeed a confirmed increase in accidents occurring on 'Dual Carriageways'.

As a cross-check, an abstraction is performed using all data from the original dataset (no longer limited to London and 2014), up to 14 vehicles involved:

```{r var7, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(subset(source, source$Number_of_Vehicles < 15), 
       aes(x = as.factor(Number_of_Vehicles),
           fill = Road_Type)) + 
  geom_bar(position = "fill") +
  labs(x="Numero di veicoli coinvolti", y = "Percentuali", title = "Relazione tra veicoli coinvolti nell'incidente e il tipo di strada", fill = "Tipo di strada")+ 
  scale_y_continuous(labels = scales::percent_format())
```

Here's the English translation:

What emerged for London can therefore be expanded to the entire national territory: as the number of vehicles involved in the accident increases, there is a higher probability that it occurred on a dual carriageway road.

___

## Day of the week and urban/rural area

```{r var8, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data_london2014, 
       aes(x = factor(Day_of_Week,
                      levels = c("1", "2", "3", "4", "5", "6", "7"),
                      labels = c("Domenica", "Lunedì", 
                                 "Martedì", "Mercoledì", 
                                 "Giovedì", "Venerdì", "Sabato")),
           fill = factor(Urban_or_Rural_Area, 
                         levels = c("1", "2"),
                         labels = c("Urbana", 
                                    "Extraurbana")))) + 
  geom_bar(position = "fill") +
  scale_y_continuous(breaks = seq(0, 1, .2), 
                     label = percent) +
  scale_fill_brewer(palette = "Set2") +
  labs(y = "", 
       fill = "Urbana/Extraurbana",
       x = "",
       title = "") +
  theme_minimal()
```

There are no major differences between days of the week, except for a slight increase in accidents on rural roads during weekends (Saturday and Sunday). One hypothesis could be day trips / commuters who finish their work/academic week on Saturday and return to the city on Sunday. However, the increase is barely noticeable, so it is not explored further.

___

## Weather conditions and month of the year

```{r var9, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data_london2014, 
       aes(x = factor(Month, levels = c("1", "2", "3", "4", "5", "6", "7","8","9","10","11","12"),
                      labels = c("Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre")),
           fill = as.factor(Weather_Conditions))) + 
  geom_bar(position = "stack") +
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  labs(x="", y = "", title = "", fill = "Meteo") 
```

Please note that the 'Other' category includes: haze, fog, snow with light wind, snow with strong wind, etc. This information explains why this category is not present during the summer months.

Most accidents occurred in 'Fine' weather conditions in all months of the year. It is important to remember that, as introduced in the previous sections, the 'Fine' category includes many more weather conditions than perfectly clear skies (light wind, light rain) as long as they are not invalidating the act of driving.

Following is a tree diagram that highlights even more strikingly how "Fine" can potentially encompass many more weather conditions than clear skies:

```{r var10, echo=FALSE, message=FALSE, warning=FALSE}
plotdata <- data_london2014 %>%
  count(Weather_Conditions)

ggplot(plotdata, 
       aes(fill = Weather_Conditions, 
           area = n, 
           label = Weather_Conditions)) +
  geom_treemap() + 
  geom_treemap_text(colour = "white", 
                    place = "centre") +
  labs(title = "Incidenti per mese") +
  theme(legend.position = "none")
```

___

## People involved, time and day of the accident

```{r var11, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data_london2014,
       aes(x = factor(Day_of_Week,
                      levels = c(1,2,3,4,5,6,7),
                      labels= c("Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato")),
          y = Time, size = Number_of_Casualties)) +
  geom_point(alpha = 0.5,
             fill="cornflowerblue",
             color="black",
             shape=21) +
  scale_size_continuous(range = c(1, 14)) +
  labs(title = "",
       x = "",
       y = "Orario dell'incidente")
```

The chart shows that on weekends, during the early hours of the morning, accidents involve more injured/victims.

___
___

# City Comparison

In conclusion to the analysis, the top five cities among the "largest urban agglomerations" in the United Kingdom are considered for a comparison between them. The main purpose is to identify common characteristics in the trend of road accidents among the major British urban centers.

Specifically:
* London
* Manchester
* Birmingham
* Bradford
* Glasgow

```{r var12, echo=TRUE, message=FALSE, warning=FALSE}
data_manchester <- subset(data, data$Latitude >= 53.4158 & data$Latitude <= 53.5458 & data$Longitude >= -2.3534 & data$Longitude <= -2.1318)
data_birmingham <- subset(data, data$Latitude >= 52.4212 & data$Latitude <= 52.5512 & data$Longitude >= -1.9954 & data$Longitude <= -1.7854) 
data_bradford <- subset(data, data$Latitude >= 53.7310 & data$Latitude <= 53.8610 & data$Longitude >= -1.8644 & data$Longitude <= -1.6544) 
data_glasgow <- subset(data, data$Latitude >= 55.7992 & data$Latitude <= 55.9292 & data$Longitude >= -4.3568 & data$Longitude <= -4.1468) 
```

```{r var13, echo=FALSE, message=FALSE, warning=FALSE}
data_london$City_Name <- "London"
data_london <- data_london %>% relocate(City_Name, .before = "Longitude")

data_manchester$City_Name <- "Manchester"
data_manchester <- data_manchester %>% relocate(City_Name, .before = "Longitude")

data_birmingham$City_Name <- "Birmingham"
data_birmingham <- data_birmingham %>% relocate(City_Name, .before = "Longitude")

data_bradford$City_Name <- "Bradford"
data_bradford <- data_bradford %>% relocate(City_Name, .before = "Longitude")

data_glasgow$City_Name <- "Glasgow"
data_glasgow <- data_glasgow %>% relocate(City_Name, .before = "Longitude")

data_cities <- rbind(data_london, data_manchester, data_birmingham, data_bradford, data_glasgow)

X <- data_cities %>%
  count(City_Name, Year)

plotdata <- spread(X, Year, n)

plotdata <- as.data.frame(plotdata)
row.names(plotdata) <- plotdata$City_Name
plotdata$City_Name <- NULL

# ordering
sort.order <- order(plotdata$"2014")
colors <- rev(brewer.pal(5, "Blues"))

superheat(plotdata,
          scale = FALSE,
          left.label.text.size=3,
          bottom.label.text.size=3,
          bottom.label.size = .05,
          heat.pal = colors,
          order.rows = sort.order,
          title = "Incidenti annui nelle 5 città più popolose del Regno Unito")
```

The chart shows that, for all cities except London, there is a downward trend in terms of the number of accidents over the years, with an increase in accidents in 2014.

Keeping in mind what has already been said in the previous analyses, the same trend does not emerge in the city of London: in fact, the number of accidents remains rather stable over the years. The only similarity between London and the other four cities is precisely this increase in accidents recorded in 2014 compared to the previous year.

___
___

#Conclusions

The analysis of the data conducted in these pages reveals important considerations and reflections. While not identifying striking patterns or trends, it is significant that the analysis has contributed to providing hypotheses for a greater understanding of the complex dynamics of road accidents in the United Kingdom. This has led to some observations that could be useful for the planning and implementation of targeted interventions aimed at improving road safety.

Finally, the description of the dataset with the level of detail proposed in this analysis provides an opportunity to further explore the research, exploring other factors that could have affected the definition of improvement strategies. Some examples could be attributes closely related to the psychophysical conditions of the driver at the time of the accident, as well as personal information (such as age or years of driving experience) and/or information on the specific vehicle, both identifying (model, body type, engine capacity, type - whether two or four wheels, whether utility, light commercial vehicle, sports car, bus, freight transport, etc.) and contextual (speed at the time of impact, number of passengers, vehicle accident history, etc.).

In conclusion, even when the results are not surprising, data analysis is still a very effective tool to faithfully describe reality and represents an important step towards understanding a critical problem and in the search for effective solutions to improve safety on the roads.
