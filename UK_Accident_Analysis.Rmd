---
title: 'Incidenti Stradali nel Regno Unito: un''analisi descrittiva sulla distribuzione dei sinistri'
author: "Giorgio Dramis"
date: "2024-02-24"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

# Introduzione

Gli incidenti stradali hanno conseguenze significative per la sicurezza delle persone ed i costi socio-economici, soprattutto nelle grandi metropoli. L'analisi dei dati, in questo campo, può rivelarsi fondamentale per comprenderne i **fattori scatenanti** principali, identificare le aree ad alto rischio e, con l'utilizzo del machine learning, sviluppare strategie efficaci per **prevenire** incidenti futuri e migliorare la sicurezza stradale.

Secondo i dati del Dipartimento dei Trasporti, nel 2014 il maggior numero di incidenti stradali nel Regno Unito è stato causato dal conducente. **Inesperienza** e **comportamenti scorretti**, le cause maggiori. Seguiti da **distrazione**, che causò 1 incidente su 5, mentre alle **infrastrutture** sono addossate le colpe del 17% circa di incidenti.

Il presente studio, basato su un dataset che raccoglie dati di sinistri nel Regno Unito su un orizzonte di quasi dieci anni, si propone di effettuare una descrizione esaustiva del fenomeno degli incidenti stradali, esponendo le circostanze più tipiche in cui si verificano, come le condizioni atmosferiche, lo stato del manto stradale, l'ora del giorno.

## Descrizione del dataset

Come menzionato in precedenza, il __[dataset](https://www.kaggle.com/code/piyushkr303/accident-severity-prediction-98-5-accuracy/input)__ utilizzato per l'analisi a seguire è un registro di 9 anni di incidenti stradali, dal 2005 al 2014, per un totale di poco più di un milione e mezzo di osservazioni.

```{r inport, echo=TRUE, message=FALSE, warning=FALSE}
source <- read.csv("UK_Accident.csv")
```

Il dataset originale si compone di 33 variabili, descritte a seguire:

_Variabili numeriche:_

* X: un progressivo, univoco per ciascuna osservazione;
* Accident Index: codice numerico identificativo di ciascuna osservazione;
* Location Easting OSGR: la sigla sta per "Ordnance Survey Grid Reference", un sistema di riferimento geografico utilizzato nel Regno Unito per identificare la posizione di un punto sulla superficie terrestre. Questa variabile identifica la coordinata a Est secondo questo sistema;
* Location Nothing OSGR: la coordinata a Nord analoga alla variabile precedente;
* Longitude: coordinata di longitudine;
* Latitude: coordinata di latitudine;
* Date: data dell'incidente;
* Year: esclusivamente l'anno dell'incidente;
* Police force: la squadra di polizia relativa all'area geografica che interviene sull'incidente;
* Number of vehicles: numero di veicoli coinvolti nell'incidente;
* Number of casualities: numero di vittime/feriti coinvolti nell'incidente;
* Day of the week: giorno della settimana dell'incidente;
* Time: orario dell'incidente;
* Local Authority District: codice identificativo della suddivisione amministrativa di una contea o a una regione dove si è verificato l'incidente;
* Local Authority Highway: codice identificativo dell'autorità locale responsabile della manutenzione, sicurezza e miglioramento della strada dove si è verificato l'incidente. Include la segnaletica stradale, la pavimentazione, la gestione del traffico ed altre aree di competenza;
* First road class: codice identificativo del tipo di strada dove si è verificato l'incidente. A questa categoria appartengono autostrade, strade a carreggiata doppia, strade principali urbane, etc;
* First road number: numero identificativo della strada dell'incidente (First Road);
* Second road class: codice identificativo del tipo di strada dove si è verificato l'incidente. A questa categoria appartengono strade a carreggiata singola, strade urbane secondarie, strade di quartiere, etc;
* Second road number: numero identificativo della strada dell'incidente (Second Road);
* Speed limit: limite di velocità della strada dove si è verificato l'incidente;

_Variabili categoriche:_

* Accident severity: gravità dell'incidente, su una scala da 1 (più grave) a 3 (meno grave);
* Road type: dove si è verificato l'incidente - strada a carreggiata singola, doppia, rotonda, etc;
* Junction control: tipo di gestione del traffico nei casi di incroci - vigile, semaforo, nulla, etc;
* Pedestrian crossing human control: tipo di gestione dell'attraversamento pedonale ove applicabile - persona autorizzata, con segnaletica, nulla, etc;
* Pedestrian crossing physical facilities: tipo di infrastruttura per consentire l'attraversamento pedonale ove applicabile - semaforo, strisce pedonali, nulla, etc;
* Light conditions: condizioni di visibilità - luce diurna, oscurità con lampioni, buio, etc;
* Weather conditions: condizioni atmosferiche - pioggia, nebbia, forti venti, etc;
* Road surface conditions: condizioni del manto stradale - bagnato, ghiacciato, nulla, etc;
* Special conditions at site: condizioni particolari circostanziali - semaforo malfunzionante, lavori in corso lungo la carreggiata, fango, etc;
* Carriageway hazards: ostacoli sulla carreggiata - attraversamento di animali, veicolo ostruendo il passaggio, coinvolgimento in un incidente a catena, etc;
* Urban or rural area: variabile binaria che indica se la strada dove è avvenuto l'incidente fa parte di un'area urbana o extraurbana;
* "Did police officer attend scene of accident?": variabile binaria che indica se l'incidente stradale ha richiesto o no l'intervento delle forze dell'ordine;
* LSOA of accident location: la sigla sta per 'Lower Layer Super Output Area', codice numerico identificativo dell'unità geografica secondo una suddivisione caratteristica del National Statistics and Registration Service nel Regno Unito, per pubblicare dati statistici;

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
#intall.packages("webshot")
#intall.packages("webshot2")
#install.packages("readxl")
#install.packages("dplyr")
#install.packages("caret")
#install.packages("plotly")
#install.packages("extrafont")
#install.packages("lubridate")
#install.packages("sf")
#install.packages("ggmap")
#install.packages("ggplot2")
#install.packages("scales")
#install.packages("treemapify")
#install.packages("magick")
#install.packages("gganimate")
#install.packages("tidyr")
#install.packages("RColorBrewer")
#install.packages("superheat")

library(webshot)
library(webshot2)
library(readxl)
library(gganimate)
library(RColorBrewer)
library(magick)
library(treemapify)
library(extrafont)
library(caret)
library(dplyr)
library(lubridate)
library(plotly)
library(ggmap)
library(ggplot2)
library(sf)
library(scales)
library(tidyr)
library(superheat)
```

___

## Pre-processamento dei dati e pulizia del dataset

Prima di procedere con la visualizzazione di grafici esplicativi, o qualsiasi altra analisi, è necessario fare delle operazioni per correggere imperfezioni nei dati e renderli omogenei.

```{r preprocessing, echo=FALSE, message=FALSE, warning=FALSE}
valori_null <- is.na(source)

source_null <- source[rowSums(valori_null)>0, ] #numero di valori nulli pari a 101, irrilevanti confrontati con le dimensioni del dataset

data <- na.omit(source) #eliminazione dal dataset

# dalla colonna date viene estrapolato esclusivamente il mese. Viene creata un'altra colonna con questa informazione e la colonna originale date viene rimossa

data$Date <- as.Date(data$Date, format = "%d/%m/%Y") #conversione del formato in data

data$Month <- month(data$Date)

# eliminazione colonne

data <- data[ ,-c(1:4,11,14,16,17,21,22,31,32)]

dummy <- data

dummy <- dummy %>% relocate(Day_of_Week, .after = "Month")

dummy <- dummy %>% relocate(Time, .after = "Day_of_Week")

data <- dummy

# modifica alla colonna time: vengono mantenute solo le ore ed eliminati i minuti
data$Time <- substr(data$Time, 1, 2)

# Eliminazione dei duplicati

duplicati <- data[duplicated(data) | duplicated(data, fromLast = TRUE), ]

# si mantiene solo la prima occorrenza di ciascun valore duplicato nella colonna
data <- data[!duplicated(data), ]

data_backup <- data

#rimozione dall'environment per ordine

remove(duplicati)
remove(source_null)
remove(valori_null)
remove(dummy)

```

Dapprima viene effettuato un conteggio delle osservazioni che contengono valori nulli o Na nelle celle di qualsiasi variabile. Risultano essere diametralmente inferiori del totale delle righe (pari a 101), di conseguenza vengono eliminate dal dataset.

A seguito delle righe, è conveniente effettuare una scrematura anche sulle colonne. Vi sono difatti attributi ridondanti o informazioni che non sono utili all'analisi, come per esempio tutte le diverse coordinate appartenenti a sistemi diversi o i codici progressivi univoci. Nella sottospecie, vengono effettuate le seguenti modifiche:

* X e Accident Index vengono rimossi;
* Location EASTing OSGR e Location NORTHing OSGR sono ridondanti, poiché in possesso di latitudine e longitudine;
* Discorso simile per LSOA of Accident Location: si tratta di un'altra maniera di localizzare gli incidenti;
* La variabile sulla presenza o no di un agente di polizia sul luogo dell'incidente è ambigua se confrontata con la variabile 'Police Force'. Viene rimossa;
* Le variabili che descrivono la tipologia di strada, First road class e First road number (così come i corrispettivi Second road class e Second road number) sono marginali rispetto all'analisi condotta. Vengono rimosse;
* Local Authority District e Local Authority Highway vanno di pari passo, prevedendo un'alta correlazione, la prima viene eliminata;
* L'informazione relativa al mese dell'incidente viene estrapolata dalla colonna ove è contenuta l'intera data e trapiantata in un'altra variabile "Month". La data, in formato stringa, viene eliminata;
* L'ora dell'incidente viene decurtata dei minuti.

Tutte le variabili restanti sono infine state sottoposte ad uno screening in cerca di eventuali duplicati. Nelle sezioni a seguire, sono mostrate ulteriori verifiche per spiegarne il comportamento e collegarlo all'incidenza degli incidenti stradali.

___

## Relazioni tra le variabili: matrice di correlazione

Alla ricerca di pattern e tendenze 'nascoste' tra i dati, ci si avvale spesso della matrice di correlazione, poiché fornisce insight preziosi sulle relazioni tra le variabili. Attraverso questo strumento, intuitivamente, è semplice comprendere quali variabili sono correlate e in che misura, fornendo così una base solida per prendere decisioni informate.

Ai fini dell'analisi di questo lavoro, lo scopo principale di questo passaggio è di selezionare le variabili più rilevanti da includere nella successiva esplorazione dei dati, ma generalmente visualizzare le correlazioni aiuta a individuare potenziali problemi di multicollinearità. Questi, infatti, influenzano negativamente la precisione dei modelli predittivi durante l'implementazione di algoritmi di classificazione o regressione.

In sintesi, l'analisi delle matrici di correlazione è un passo essenziale nell'analisi dei dati poiché fornisce una panoramica chiara delle relazioni tra le variabili e guida il processo decisionale in modo più efficace e accurato.

Sono qui riassunte le correlazioni più forti all'interno del dataset:

```{r correlation, echo=FALSE, message=FALSE, warning=FALSE}
encode_labels <- function(column) {
  unique_labels <- unique(column)
  labels_to_numbers <- as.numeric(factor(column, levels = unique_labels))
  return(labels_to_numbers)
}

# per generare la matrice di correlazione, si sfrutta un dataset temporaneo creato ad-hoc con variabili di tipo numerico

data_temp <- data %>% mutate_if(is.character, encode_labels)
cormatrix <- cor(data_temp)

high_correlations <- which(abs(cormatrix) > 0.49 & cormatrix != 1, arr.ind = TRUE)

print("Coppie di variabili con correlazione sopra 0.49:")
for (i in 1:nrow(high_correlations)) {
  row_index <- high_correlations[i, 1]
  col_index <- high_correlations[i, 2]
  correlation_value <- cormatrix[row_index, col_index]
  
  variable1 <- colnames(cormatrix)[row_index]
  variable2 <- colnames(cormatrix)[col_index]
  
  cat(sprintf("Coppia di variabili: %s, %s - Correlazione: %.2f\n", variable1, variable2, correlation_value))
}
```

Mostrandole graficamente, si può ricorrere alla Heatmap:

```{r matrix, echo=TRUE, message=FALSE, warning=FALSE}

# Heatmap correlazioni
heatmap(cormatrix, 
        col = colorRampPalette(c("blue", "white", "red"))(100),
        main = "Heatmap della Matrice di Correlazione",
        margins = c(9, 9),
        cexRow = 1, cexCol = 1)
```

Non c'è una grande varietà di correlazioni forti. La prima, tra il limite di velocità e la variabile binaria che indica se si tratti di una strada urbana o una extraurbana, è abbastanza autoesplicativa: i limiti di velocità tendono ad essere ben differenti tra le due categorie. Mentre la correlazione (più alta) tra Local Authority Highway e Police Force si spiega poichè entrambe le variabili fanno riferimento alla stessa area geografica.

Nonostante ciò, il fatto che le correlazioni non implichino causalità non scoraggia l'analisi alla ricerca di pattern significativi. Si procede dunque con la sezione di data visualization.

___

# Data visualization sulle variabili

Nella presente sezione, le variabili restanti nel dataset vengono sottoposte ad un'analisi visiva attraverso istogrammi, mappe ad albero, mappe geografiche, etc. In particolare si noti che, in tutti gli istogrammi, a colore più scuro corrisponde un maggior volume di occorrenze.

___

## Squadra di polizia

```{r police force, echo=FALSE, message=FALSE, warning=FALSE}

bar_policeforce <- plot_ly(data = as.data.frame(table(data$Police_Force)),
                           x = ~Var1, y = ~Freq,
                           type = "bar",
                           marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Squadra", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_policeforce
```

Su questa prima variabile, emerge una prevalenza di interventi in caso di incidente da parte della squadra associata convenzionalmente al valore 1. Questa informazione tornerà utile all'analisi più avanti, quando verrà circoscritta all'area di competenza relativa alla squadra 1.

___

## Numero di veicoli coinvolti

```{r number vehicles, echo=FALSE, message=FALSE, warning=FALSE}

bar_numberofvehicles <- plot_ly(data = as.data.frame(table(data$Number_of_Vehicles)),
                                x = ~Var1, y = ~Freq,
                                type = "bar",
                                marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Veicoli coinvolti", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofvehicles
```

Osservando il grafico, risulta da subito evidente come oltre i cinque veicoli coinvolti nel sinistro, le osservazioni si facciano sempre più rade. Per completezza, si fissa un upper bound a 7 veicoli (per mantenere esclusivamente i valori della variabile con più di 500 osservazioni), e le restanti, essendo irrilevanti in volume, vengono considerate outliers a tutti gli effetti ed eliminate dal dataset. Di seguito, l'istogramma aggiornato:

```{r number vehicles 2, echo=FALSE, message=FALSE, warning=FALSE}

data <- data[data$Number_of_Vehicles <7, ]

bar_numberofvehicles <- plot_ly(data = as.data.frame(table(data$Number_of_Vehicles)),
                                x = ~Var1, y = ~Freq,
                                type = "bar",
                                marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Veicoli coinvolti", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofvehicles
```

___

## Numero di feriti/vittime

```{r casualities, echo=FALSE, message=FALSE, warning=FALSE}
bar_numberofcasualities <- plot_ly(data = as.data.frame(table(data$Number_of_Casualties)),
                                   x = ~Var1, y = ~Freq,
                                   type = "bar",
                                   marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Feriti/vittime", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofcasualities
```

Anche nel caso delle persone che hanno subìto danni nell'incidente, il risultato è analogo al caso anteriore. Anche qui vengono eliminate le osservazioni (outliers) con più di 8 feriti o vittime.

```{r casualities 2, echo=FALSE, message=FALSE, warning=FALSE}

data <- data[data$Number_of_Casualties <8, ]

bar_numberofcasualities <- plot_ly(data = as.data.frame(table(data$Number_of_Casualties)),
                                   x = ~Var1, y = ~Freq,
                                   type = "bar",
                                   marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Feriti/vittime", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofcasualities
```

___

## Anno dell'incidente

```{r year, echo=FALSE, message=FALSE, warning=FALSE}
bar_year <- plot_ly(data = as.data.frame(table(data$Year)),
                    x = ~Var1, y = ~Freq,
                    type = "bar",
                    marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Anno", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_year
```

Si può notare un andamento decrescente nella numerosità degli incidenti stradali nel corso degli anni, a parte per una piccola inversione di trend tra il 2013 e il 2014. Anche questo fenomeno verrà analizzato più nel dettaglio successivamente.

___

## Giorno della settimana

```{r weekday, echo=FALSE, message=FALSE, warning=FALSE}
bar_dayoftheweek <- plot_ly(data = as.data.frame(table(data$Day_of_Week)),
                            x = ~Var1, y = ~Freq,
                            type = "bar",
                            marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Giorno", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, 
                 tickvals = 1:7,
                 ticktext = c("Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato")),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_dayoftheweek
```

Contrariamente a quanto ci si aspetterebbe, nell'arco dei nove anni, il numero di incidenti verificatosi tra il sabato e la domenica è inferiore rispetto al resto della settimana, con un picco il venerdì che è superiore alla domenica, ad esempio, di circa di 80.000 osservazioni.

Si ritiene che questo possa essere legato al traffico dei giorni lavorativi, più incidente sulla pericolosità delle strade britanniche rispetto ad una potenziale movida del weekend.

In ogni caso, è bene ricordare che questo istogramma fa riferimento esclusivamente al numero di incidenti e prescinde dalla loro gravità o dal numero di veicoli e persone coinvolti. Più avanti nell'analisi verrà mostrato come compaiano delle dinamiche interessanti quando si combinano tra loro questi attributi delle osservazioni.

___

## Orario dell'incidente

```{r time, echo=FALSE, message=FALSE, warning=FALSE}
data$Time <- as.integer(data$Time)

bar_time <- plot_ly(data = as.data.frame(table(data$Time)),
                    x = ~Var1, y = ~Freq,
                    type = "bar",
                    marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Ora", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10,
                 tickvals = 0:23),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_time
```

Altro grafico interessante, perché evidenzia come gli incidenti si verifichino con più frequenza in corrispondenza degli orari lavorativi d'ufficio: alle 8:00 quando generalmente inizia la giornata lavorativa, scolastica e accademica e poi ancora nella fascia tra le 15:00 e le 17:00 per la sua conclusione. Inoltre, notoriamente, in Gran Bretagna l'ora di cena è anticipata rispetto allo standard mediterraneo: questa componente potrebbe spiegare ulteriormente poichè a partire dalle 18:00 le occorrenze vadano a decrescere.

Si noti come la frequenza degli incidenti durante le ore notturne sia sorprendentemente bassa. Una supposizione ante-osservazione avrebbe portato ad immaginare che con la maggiore probabilità di: condizioni psicofisiche alterate e/o colpi di sonno dovuti a tarda ora o turni notturni, fosse invece questo l'orario con maggior numero di sinistri.

Si ipotizza una spiegazione di questa realtà esposta dai dati nel fatto che nel Regno Unito ci siano clima e abitudini sociali che portano i Britannici a trascorrere il loro tempo libero principalmente in casa o in luoghi chiusi; unito alla cultura gastronomica citata in precedenza che prevede pasti anticipati rispetto ad altri paesi o regioni, dinamica che spiegherrebbe il poco traffico in tarda notte.

___

## Gravità dell'incidente

```{r severity, echo=FALSE, message=FALSE, warning=FALSE}
bar_accidentseverity <- plot_ly(data = as.data.frame(table(data$Accident_Severity)),
                                x = ~Var1, y = ~Freq,
                                type = "bar",
                                marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Gravità", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_accidentseverity
```

Per quanto riguarda la gravità degli incidenti, è evidente come la stragrande maggioranza di essi si trovi nella terza categoria (gravità più bassa). 

___

## Tipologia di strada

Prima ancora di visualizzare l'istogramma della distribuzione per tipologia di strada, salta all'occhio la presenza di una piccola percentuale di osservazioni non categorizzate (valore della variabile "Unknown"). Si procede alla loro rimozione e, successivamente, si osserva il grafico.

```{r road type, echo=FALSE, message=FALSE, warning=FALSE}

table(data$Road_Type)

data <- data[data$Road_Type != "Unknown", ]

bar_roadtype <- plot_ly(data = as.data.frame(table(data$Road_Type)),
                        x = ~Var1, y = ~Freq,
                        type = "bar",
                        marker = list(color = colorRampPalette(c("#0088ff", "#120a8f"))(6))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_roadtype
```

La maggior parte dei sinistri si è verificata in strade a singola corsia (due corsie con doppio senso di marcia all'interno di una carreggiata).

___

## Limite di velocità

```{r speed limit, echo=FALSE, message=FALSE, warning=FALSE}
bar_speed <- plot_ly(data = as.data.frame(table(data$Speed_limit)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Limite [miglia/h]", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_speed
```

La modifica effettuata su questa variabile è stata di eliminare le occorrenze di limite di velocità inferiore alle 20 miglia orarie, in quanto in volume irrilevante all'analisi. Il grafico senza outliers:

```{r speed limit 2, echo=FALSE, message=FALSE, warning=FALSE}

data <- data[data$Speed_limit >20, ] #vengono eliminate le poche occorrenze di incidenti avvenuti in strade con limite di velocità inferiore o uguale al 20

bar_speed <- plot_ly(data = as.data.frame(table(data$Speed_limit)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Limite [miglia/h]", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_speed
```

___

## Gestione del traffico

```{r junction control, echo=FALSE, message=FALSE, warning=FALSE}
bar_junction <- plot_ly(data = as.data.frame(table(data$Junction_Control)),
                        x = ~Var1, y = ~Freq,
                        type = "bar",
                        marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_junction
```

Le due categorie predominanti sono quella dell'assenza di controllo (nessun segnale o vigile a gestire il traffico) o i casi laddove questa variabile non si applica (incidenti non dovuti a incroci). Un altro metodo più grafico di visualizzare la distribuzione dei casi a seconda della gestione del traffico è attraverso una mappa ad albero.

```{r junction control 2, echo=FALSE, message=FALSE, warning=FALSE}

plotdata <- data %>%
  count(Junction_Control)

ggplot(plotdata, 
       aes(fill = Junction_Control, 
           area = n, 
           label = Junction_Control)) +
  geom_treemap() + 
  geom_treemap_text(colour = "white", 
                    place = "centre") +
  labs(title = "") +
  theme(legend.position = "none")
```

___

## Gestione dell'attraversamento pedonale

```{r pedestrian human control, echo=FALSE, message=FALSE, warning=FALSE}
bar_pedControl <- plot_ly(data = as.data.frame(table(data$Pedestrian_Crossing.Human_Control)),
                          x = ~Var1, y = ~Freq,
                          type = "bar",
                          marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_pedControl

data <- data[ ,-11]
```

Dal grafico riguardante la gestione (e anche la presenza o no) di un attraversamento pedonale, si evince come la variabile sia irrilevante, poiché più del 99% delle osservazioni rientra nell'ultima categoria: che non era presente, sul luogo dell'incidente, nessun attraversamento pedonale nel raggio di 50 metri. Questo attributo viene eliminato dal dataset.

___

## Tipologia di attraversamento pedonale

```{r facility pedestrian crossing, echo=FALSE, message=FALSE, warning=FALSE}
bar_pedFacility <- plot_ly(data = as.data.frame(table(data$Pedestrian_Crossing.Physical_Facilities)),
                           x = ~Var1, y = ~Freq,
                           type = "bar",
                           marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_pedFacility

data <- data[ ,-11]
```
Analogamente alla considerazione precedente sulla variabile relativa alla gestione degli attraversamenti pedonali, anche qui la maggior parte delle osservazioni rientra nella categoria dell'assenza di attraversamento pedonale nel raggio di 50 metri. Anche questa variabile viene eliminata.

___

## Condizioni di visibilità

```{r light conditions, echo=FALSE, message=FALSE, warning=FALSE}
bar_light <- plot_ly(data = as.data.frame(table(data$Light_Conditions)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_light
```

Viste le scarse osservazioni in alcune delle categorie mostrate nel grafico, si effettuano delle semplificazioni:

* La categoria "Street Lighthning Unknown" viene eliminata: non fornisce informazioni aggiuntive;
* Le categorie relative all'oscurità, sia causata dai lampioni spenti sia dall'assenza di luce artificiale, sono state unificate;
* Le categorie rimanenti sono state rinominate.

```{r light conditions 2, echo=TRUE, message=FALSE, warning=FALSE}

table(data$Light_Conditions)

data <- data[data$Light_Conditions != "Darkness: Street lighting unknown", ]

data$Light_Conditions[data$Light_Conditions == "Darkness: Street lights present but unlit"] <- "Darkeness: No street lighting"
data$Light_Conditions[data$Light_Conditions == "Darkeness: No street lighting"] <- "Night: Complete darkness"
data$Light_Conditions[data$Light_Conditions == "Darkness: Street lights present and lit"] <- "Night: Street lights lit"
data$Light_Conditions[data$Light_Conditions == "Daylight: Street light present"] <- "Daylight"
```

A seguito di tali modifiche, il nuovo istogramma:

```{r light conditions 3, echo=FALSE, message=FALSE, warning=FALSE}
bar_light <- plot_ly(data = as.data.frame(table(data$Light_Conditions)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_light
```

___

## Condizioni atmosferiche

Prima ancora di visualizzare l'istogramma della distribuzione per le condizioni atmosferiche, salta all'occhio la presenza di una piccola percentuale di osservazioni non categorizzate (valore della variabile "Unknown"). Si procede alla loro rimozione e, successivamente, si osserva il grafico.

```{r weather, echo=FALSE, message=FALSE, warning=FALSE}

table(data$Weather_Conditions)

# eliminazione categoria"unknown"

data <- data[data$Weather_Conditions != "Unknown", ]

bar_weather <- plot_ly(data = as.data.frame(table(data$Weather_Conditions)),
                       x = ~Var1, y = ~Freq,
                       type = "bar",
                       marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_weather
```

Vengono effettuate modifiche simili al caso precedente:

```{r weather2, echo=TRUE, message=FALSE, warning=FALSE}

# unione delle categorie di pioggia (con & senza vento)

data$Weather_Conditions[data$Weather_Conditions == "Raining with high winds"] <- "Rain"
data$Weather_Conditions[data$Weather_Conditions == "Raining without high winds"] <- "Rain"
data$Weather_Conditions[data$Weather_Conditions == "Fine without high winds"] <- "Fine"

# tutte le categorie rimanenti fuse in "other"

data$Weather_Conditions[data$Weather_Conditions != "Rain" & data$Weather_Conditions != "Fine"] <- "Other"

table(data$Weather_Conditions)
```

```{r weather3, echo=FALSE, message=FALSE, warning=FALSE}

bar_weather <- plot_ly(data = as.data.frame(table(data$Weather_Conditions)),
                       x = ~Var1, y = ~Freq,
                       type = "bar",
                       marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_weather
```

Nel caso in cui insospettisca il fatto che, proprio nella nazione stereotipicamente riconosciuta come una delle più piovose in Europa, ci siano cosi pochi casi di incidenti durante la pioggia, è bene sottolineare che la categoria "fine" non è da intendersi in linea con l'immaginario comune.

In "Fine" potrebbe rientrare a tutti gli effetti una condizione di pioggia leggera, perché si sta parlando di condizioni di viabilità: un vento debole o cielo coperto, che non compromettono significativamente le capacità di guida, rientreranno in questa categoria.

___

## Condizioni del manto stradale

```{r pavement, echo=FALSE, message=FALSE, warning=FALSE}
bar_drywet <- plot_ly(data = as.data.frame(table(data$Road_Surface_Conditions)),
                      x = ~Var1, y = ~Freq,
                      type = "bar",
                      marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_drywet
```

Anche qui vengono effettuate modifiche simili al caso precedente:

```{r pavement2, echo=TRUE, message=FALSE, warning=FALSE}

# "Normal" viene eliminata. "Flood" e "Snow" vengono aggiunte alla categoria "Wet/Damp":

data <- data[data$Road_Surface_Conditions != "Normal", ]

data$Road_Surface_Conditions[data$Road_Surface_Conditions %in% c("Flood (Over 3cm of water)", "Snow")] <- "Wet/Damp"
```

Il nuovo istogramma:

```{r pavement3, echo=FALSE, message=FALSE, warning=FALSE}

bar_drywet <- plot_ly(data = as.data.frame(table(data$Road_Surface_Conditions)),
                      x = ~Var1, y = ~Freq,
                      type = "bar",
                      marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_drywet
```

___

## Condizioni particolari

```{r special, echo=FALSE, message=FALSE, warning=FALSE}
bar_special <- plot_ly(data = as.data.frame(table(data$Special_Conditions_at_Site)),
                       x = ~Var1, y = ~Freq,
                       type = "bar",
                       marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_special

# La categoria "none" costituisce il 97% circa del totale. Rimozione della colonna:

data <- data[,-14]
```

C'è scarsa variabilità tra i dati, considerando che la categoria "None" costituisce circa il 97% del totale delle occorrenze. La variabile viene eliminata.

___

## Ostacoli sulla carreggiata

```{r carriageway, echo=FALSE, message=FALSE, warning=FALSE}
bar_carriage <- plot_ly(data = as.data.frame(table(data$Carriageway_Hazards)),
                        x = ~Var1, y = ~Freq,
                        type = "bar",
                        marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_carriage

data <- data[,-14]
```

Discorso analogo anche per la variabile che indica se vi sono ostacoli o altri pericoli inattesi sulla carreggiata. Viene rimossa.

___

## Urbane VS Extraurbane

A questa variabile appartengono tre categorie. Tuttavia, la terza contiene solo una trentina di occorrenze, per cui viene eliminata dal dataset.

```{r urban, echo=FALSE, message=FALSE, warning=FALSE}
data <- data[data$Urban_or_Rural_Area != 3, ]

bar_urban <- plot_ly(data = as.data.frame(table(data$Urban_or_Rural_Area)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Tipologia di strada", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_urban
```

___

## Distretto di sicurezza stradale

```{r authority, echo=FALSE, message=FALSE, warning=FALSE}
bar_district <- plot_ly(data = as.data.frame(table(data$Local_Authority_.Highway.)),
                        x = ~Var1, y = ~Freq,
                        type = "bar",
                        marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_district
```

Disponendo delle coordinate relative a dove si sono verificati gli incidenti, una mappa della Gran Bretagna potrebbe rendere di più l'idea rispetto a questo istogramma, rendendo di conseguenza questa variabile ridondante.

___
___

# Data visualization: analisi più approfondite
## Mappe geografiche della Gran Bretagna

Nella sezione a seguire, verranno analizzate diverse mappe geografiche dell'intera Gran Bretagna, e in particolare ci si concentrerà sull'area metropolitana di Londra. L'analisi dei dati sulle mappe geografiche è una pratica essenziale per comprendere e interpretare le relazioni spaziali all'interno dei dati. Per individuare eventuali modelli, tendenze e distribuzioni, mappare gli incidenti stradali potrebbe essere un'ottima strategia.

Questo tipo di analisi offre l'opportunità di esplorare le caratteristiche ambientali o infrastrutturali correlate agli incidenti, valutare l'impatto di interventi di sicurezza stradale ed eventualmente fornire a chi di dovere strumenti per pianificare interventi mirati per migliorare la sicurezza delle strade. 

```{r map1, echo=FALSE, message=FALSE, warning=FALSE}

register_google("AIzaSyA9mvRjStf4XhW0Y98-TAchzmA7KKyaTNE")

UK_map <- get_map(location = c(lon = -2.3180, lat = 53.501014), 
                  zoom = 6, 
                  maptype = "terrain")

ggmap(UK_map)
```

Le tre mappe seguenti riflettono la densità degli incidenti distribuiti sull'intero territorio nazionale. Nello specifico, riferendosi ai tre livelli di gravità in cui sono classificati tutti i sinistri del dataset, verranno mostrate:

* In <span style="color:#e15602;">arancione</span>, la densità degli incidenti di gravità bassa
* In <span style="color:#df0602;">rosso</span>, la densità degli incidenti di gravità media
* In <span style="color:#780000;">bordeaux</span>, la densità degli incidenti di gravità alta

```{r map2, echo=TRUE, message=FALSE, warning=FALSE}

map_UKseverity3 <- ggmap(UK_map) +
  stat_density_2d(data = subset(data, data$Accident_Severity == 3), aes(x = Longitude, y = Latitude), geom = "path", color = "#e15602", size = 1, n = 100, bins = 30) +
  ggtitle("Densità per gravità 3")

map_UKseverity3

map_UKseverity2 <- ggmap(UK_map) +
  stat_density_2d(data = subset(data, data$Accident_Severity == 2), aes(x = Longitude, y = Latitude), geom = "path", color = "#df0602", size = 1, n = 300, bins = 30) + 
  ggtitle("Densità per gravità 2")

map_UKseverity2

map_UKseverity1 <- ggmap(UK_map) +
  stat_density_2d(data = subset(data, data$Accident_Severity == 1), aes(x = Longitude, y = Latitude), geom = "path", color = "#780000", size = 1, n = 500, bins = 30) +
  ggtitle("Densità per gravità 1")

map_UKseverity1
```

Si evince soprattutto come, a prescindere dal grado di severità, gli incidenti si concentrino maggiormente nei centri urbani. Londra, in particolare, sembra essere l'area metropolitana a più alta densità di incidenti. Si fa largo l'ipotesi che, in particolare, ci sia un collegamento tra la squadra di polizia 1, che spiccava nell'istogramma durante l'analisi delle variabili, e la città di Londra.

```{r map3, echo=TRUE, message=FALSE, warning=FALSE}

bar_policeforce

# si individui sulla mappa a quale area fa riferimento la squadra di polizia 1:

ggmap(UK_map) + geom_point(data = subset(data, data$Police_Force == 1), aes(x = Longitude, y = Latitude), color = "red", size = 0.5)

```

La mappa è inequivocabile: l'area sulla quale opera la 'Police Force' associata convenzionalmente al valore 1 è la capitale britannica. Ciò è coerente con i grafici di densità appena mostrati.
Pertanto, si prosegue con un'analisi più dettagliata sulla sola città di Londra.

___

## Mappe geografiche di Londra

```{r london, echo=TRUE, message=FALSE, warning=FALSE}
data_london <- subset(data, data$Latitude >= 51.15 & data$Latitude <= 51.8 & data$Longitude >= -0.5 & data$Longitude <= 0.5)
dim(data_london)
```

Viste le dimensioni del dataset, sarebbe conveniente tentare di ridurre ulteriorimente le occorrenze osservate, o la mappa geografica risultante sarà illeggibile. Una scelta può essere effettuata limitando i dati da visualizzare ad un intervallo di tempo specifico. Viene osservata la distribuzione degli incidenti di anno in anno con un istogramma:

```{r london2, echo=FALSE, message=FALSE, warning=FALSE}
bar_year <- plot_ly(data = as.data.frame(table(data_london$Year)),
                    x = ~Var1, y = ~Freq,
                    type = "bar",
                    marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    title = list(text = "Incidenti annuali nella città di Londra", font = list(color = 'black', family = 'Calibri', size = 26, weight = 'bold')),
    xaxis = list(title = list(text = "Anno", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_year
```

Il numero di incidenti è rimasto piuttosto simile negli anni, senza discostarsi particolarmente dalla media del decennio. A differenza del trend osservato su tutto il terrirorio UK, nel caso di Londra non si evince un andamento decrescente.

In cerca di una tendenza, si decide di isolare gli incidenti di gravità 1 e 2:

```{r london3, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(subset(data_london, Accident_Severity != 3), 
       aes(x = as.factor(Year), 
           fill = as.factor(Accident_Severity))) + 
  geom_bar(position = "stack") +
  labs(x="Anno", y = "Osservazioni", title = "Andamento degli incidenti di gravità 1 & 2", fill = "Gravità")
```

Isolando gli incidenti più gravi, è emerso un trend decrescente più evidente. Considerando il piccolo aumento che si era registrato tra il 2013 e il 2014 a monte di questa selezione, si deduce che ad essere aumentati siano stati gli incidenti di gravità inferiore (categoria 3, esclusa da quest'ultimo grafico).

A valle di ciò consideriamo l'ultimo anno di osservazioni (il 2014) per condurre l'analisi su Londra con focus sugli incidenti più gravi (1 & 2).

Il primo confronto che si decide di effettuare coinvolge la variabile del numero di veicoli coinvolti nel sinistro.

```{r london4, echo=FALSE, message=FALSE, warning=FALSE}
data_london2014 <- subset(data_london, data_london$Year > 2013 & data_london$Accident_Severity != 3)

# si visualizza l'istogramma degli incidenti per numero di veicoli coinvolti

bar_numberofvehiclesln2014 <- plot_ly(data = as.data.frame(table(data_london2014$Number_of_Vehicles)),
                                      x = ~Var1, y = ~Freq,
                                      type = "bar",
                                      marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Veicoli coinvolti", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_numberofvehiclesln2014

# si visualizzano due e un veicolo sulla mappa

London_map <- get_map(location = c(lon = -0.1180, lat = 51.5099), maptype = "roadmap", zoom = 10)

ggmap(London_map) + geom_point(data = subset(data_london2014, Number_of_Vehicles == 1), aes(x = Longitude, y = Latitude), color = "red", size = 0.5) + 
  geom_point(data = subset(data_london2014, Number_of_Vehicles == 2), aes(x = Longitude, y = Latitude), color = "blue", size = 0.5)
```

Le due categorie più popolose (1 veicolo e 2 veicoli) sono rappresentate sulla mappa rispettivamente in rosso e in blu. Ad ogni modo, la dimensione del dataset non consente una visualizzazione adeguata. Si decide di analizzare la distribuzione di tali incidenti in fasce orarie:

```{r london5, echo=FALSE, message=FALSE, warning=FALSE}

bar_Ltime <- plot_ly(data = as.data.frame(table(data_london2014$Time)),
                     x = ~Var1, y = ~Freq,
                     type = "bar",
                     marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    xaxis = list(title = list(text = "Ora", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10,
                 tickvals = 0:23),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_Ltime 
```

Si procede alla creazione di tre fasce orarie: mattina, pomeriggio e notte.

```{r london6, echo=FALSE, message=FALSE, warning=FALSE}
data_london2014$day_split <- data_london2014$Time 

data_london2014$day_split[data_london2014$Time %in% c(21,22,23,0,1,2,3,4,5,6)] <- "night"
data_london2014$day_split[data_london2014$Time %in% c(7,8,9,10,11,12,13,14)] <- "morning"
data_london2014$day_split[data_london2014$Time %in% c(15:20)] <- "afternoon"

ggmap(London_map) + geom_point(data = subset(data_london2014, day_split == "morning"), aes(x = Longitude, y = Latitude), color = "red", size = 1) + ggtitle("Mattina")
ggmap(London_map) + geom_point(data = subset(data_london2014, day_split == "afternoon"), aes(x = Longitude, y = Latitude), color = "blue", size = 1) + ggtitle("Pomeriggio")
ggmap(London_map) + geom_point(data = subset(data_london2014, day_split == "night"), aes(x = Longitude, y = Latitude), color = "black", size = 1) + ggtitle("Notte")
```

A parte una concentrazione di incidenti nel centro di Londra durante la notte, non si rilevano particolari informazioni. La mappa non evidenzia agglomerati di incidenti nella zona periferica, del centro urbano, o poligoni industriali chiari a seconda della fascia oraria.

Si decide di indagare dunque sui mesi dell'anno 2014 tramite istogramma e mappa ad albero.

```{r london7, echo=FALSE, message=FALSE, warning=FALSE}

bar_month <- plot_ly(data = as.data.frame(table(data$Month)),
                            x = ~Var1, y = ~Freq,
                            type = "bar",
                            marker = list(color = ~Freq, colorscale = list(c(0, 1), c("#0088ff", "#120a8f")))) %>%
  layout(
    title = list(text = "Distribuzione mensile incidenti nel 2014", font = list(color = 'black', family = 'Calibri', size = 26, weight = 'bold')),
    xaxis = list(title = list(text = "Mese", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, 
                 tickvals = 1:12,
                 ticktext = c("Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre")),
    yaxis = list(title = list(text = "Osservazioni", font = list(color = 'black', family = 'Calibri', size = 20, weight = 'bold'), standoff = 20),
                 tickfont = list(color = 'black', family = 'Calibri', size = 16, weight = 'bold'), ticklen = 10, gridcolor = '#a0a0a0', zeroline = FALSE),
    paper_bgcolor = 'white',
    plot_bgcolor = 'white',
    margin = list(l = 110, r = 70, b = 100, t = 100)
  )

bar_month

# Mappa ad albero:

plotdata <- data_london2014 %>%
  count(Month)

ggplot(plotdata, 
       aes(fill = Month, 
           area = n, 
           label = Month)) +
  geom_treemap() + 
  geom_treemap_text(colour = "white", 
                    place = "centre") +
  labs(title = "Incidenti per mese") +
  theme(legend.position = "none")

```

Anche prendendo in esame i mesi, sembrerebbe non emergere nessun pattern rilevante (contrariamente a quanto si immaginerebbe pensando al traffico delle vacanze estive o del periodo natalizio/altre festività).

___
___

# Il caso di Londra: relazioni tra le variabili

Si prosegue analizzando la relazione tra variabili con gli istogrammi in percentuale: per poter fare un'analisi significativa sarà necessario investigare i casi particolari uno ad uno.

## Visibilità e condizioni del manto stradale

```{r var1, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data_london2014, 
       aes(x = data_london2014$Light_Conditions,
           fill = data_london2014$Road_Surface_Conditions)) + 
  geom_bar(position = "fill") +
  labs(x="", y = "", title = "", fill = "Condizioni asfalto")+ 
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  scale_y_continuous(labels = scales::percent_format())
```

In condizioni di buona visibilità, i dati riflettono che gli incidenti si verificano prevalentemente con l'asfalto asciutto (e con percentuale minima di ghiaccio): questo trova spiegazione anche nella temperatura del giorno (più alta rispetto alla notte) che consente al ghiaccio di sciogliersi, mentre la luce aiuta il guidatore ad individuare eventuali pericoli legati all'asfalto bagnato.

Durante la notte, le percentuali di incidenti con asfalto bagnato o ghiacciato sono più rilevanti,soprattutto in condizioni di buio senza lampioni né altra illuminazione artificiale.

___

## Visibilità e gravità dell'incidente

```{r var2, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data_london2014, 
       aes(x = as.factor(data_london2014$Accident_Severity),
           fill = data_london2014$Light_Conditions)) + 
  geom_bar(position = "fill") +
  labs(x="Gravità dell'incidente", y = "", title = "", fill = "Condizioni luce")+ 
  scale_y_continuous(labels = scales::percent_format())
```

Circa il 45% degli incidenti gravi si verifica durante le ore notturne. Una cosa interessante da notare sull'istogramma è la sorprendentemente piccola incidenza della luce artificiale (come i lampioni) nel prevenire gli incidenti. La porzione di incidenti che si sono verificati in condizioni di completa oscurità, infatti, non è drammaticamente superiore a quelli in condizioni di luce artificiale - come se la presenza o no dei lampioni non riducesse la probabilità di incidenti.

Un'importante differenziazione da effettuare sarebbe individuare esattamente dove si sono verificati tali incidenti: è possibile che la maggior parte di incidenti gravi si siano verificati su strade non illuminate.

```{r var3, echo=FALSE, message=FALSE, warning=FALSE}

London_map <- get_map(location = c(lon = -0.1180, lat = 51.5099), maptype = "roadmap", zoom = 9)

ggmap(London_map) +geom_point(data = subset(data_london2014, data_london2014$Light_Conditions == "Night: Complete darkness"), aes(x = Longitude, y = Latitude), color = "black", size = 1) 
```

Come prevedibile, tutti gli incidenti avvenuti in 'Complete Darkness' sono distanti dal centro urbano di Londra, che si suppone sia quasi sempre ben illuminato.

___

## Gravità dell'incidente e tipo di strada

```{r var4, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data_london2014, 
       aes(x = as.factor(Accident_Severity),
           fill = Road_Type)) + 
  geom_bar(position = "fill") +
  labs(x="Gravità dell'incidente", y = "", title = "", fill = "Tipo di strada")+ 
  scale_y_continuous(labels = scales::percent_format())
```

* La maggior parte degli incidenti avviene in "Single Carriageway" (carreggiata con singola corsia in ciascun senso di marcia). Cosa verosimile se si immagina, ad esempio, una manovra di sorpasso che in queste condizioni è più pericolosa per l'esposizione a uno scontro frontale;
* La seconda categoria è 'Dual Carriageway' - il rischio di frontali è quasi escluso qui, soprattutto se c'è un guardrail a separare le due carreggiate, ma continuano ad esistere tutte le altre cause (sbandamenti, tamponamenti, sopratutto a catena poichè si tratta di strade tipiche dell'alta velocità come le autostrade);
* Autoesplicativo che le rotonde siano più sicure, visto il loro obiettivo di rendere lo scorrimento del traffico più fluido;
* Autoesplicativo anche come ci siano pochi incidenti che avvengono nelle strade a senso unico;
* Il basso volume di incidenti nelle 'Slip Road' (ossia corsie di accelerazione/decelerazione) trova spiegazione nel fatto che il transito è limitato all'immissione nella strada principale e relativamente rapido.

Per ricevere qualche indizio su quali possano essere le categorie di incidente caratteristiche del 'Single Carriageway' (se scontri frontali, tamponamenti a catena o altri casi in cui è coinvolto esclusivamete il veicolo incidentato) si indaga la relazione tra il numero di veicoli coinvolti e la categoria di strada:

```{r var5, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data_london2014, 
       aes(x = Number_of_Vehicles,
           fill = Road_Type)) + 
  geom_bar(position = "fill") +
  labs(x="Numero di veicoli", y = "Percentuali", title = "Relazione tra severità dell'incidente e il tipo di strada", fill = "Tipo di strada")+ 
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  scale_y_continuous(labels = scales::percent_format())
```

Le occorrenze nelle strade a senso unico e corsie di accelerazione/decelerazione 'spariscono' oltre i 3 veicoli coinvolti, intuitivamente. Per quanto riguarda le rotonde, fino a 4 veicoli coinvolti la percentuale di incidenti continua ad esistere.

Infine è interessante notare come, apparentemente, all'aumentare dei veicoli coinvolti, sia più improbabile che si tratti di una carreggiata con due sole corsie opposte: assume infatti importanza la percentuale di doppia corsia.

Per approfondire, si visualizza l'animazione dell'aumento dei casi di incidenti su strade a doppia corsia all'aumentare dei veicoli coinvolti. Vengono esaminati in relazione al numero persone coinvolte.

(Naturalmente, in PDF si perderà la possibilità di visualizzare l'animazione).

```{r var6, echo=TRUE, message=FALSE, warning=FALSE}
animazione <- ggplot(data, 
                     aes(x = data$Number_of_Casualties,
                         fill = as.factor(data$Road_Type))) + 
  geom_bar(position = "fill") +
  labs(x="Feriti/vittime coinvolti", y = "Percentuale di osservazioni", title = "Veicoli coinvolti: {frame_time}", fill = "Strada:")+ 
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  scale_y_continuous(labels = scales::percent_format()) +
  transition_time(Number_of_Vehicles) + ease_aes('linear')

animate(animazione, nframes = 100, duration = 10, fps = 5)
```

L'animazione mostra come all'aumentare del numero di veicoli coinvolti (e delle persone ferite/decedute) effettivamente si confermi un aumento di sinistri che avvengono sulle 'Dual Carriageway'.

Per una controprova, si effettua un'astrazione con tutti i dati del dataset originale (non piu' limitato a Londra e nel 2014), fino a 14 veicoli coinvolti:

```{r var7, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(subset(source, source$Number_of_Vehicles < 15), 
       aes(x = as.factor(Number_of_Vehicles),
           fill = Road_Type)) + 
  geom_bar(position = "fill") +
  labs(x="Numero di veicoli coinvolti", y = "Percentuali", title = "Relazione tra veicoli coinvolti nell'incidente e il tipo di strada", fill = "Tipo di strada")+ 
  scale_y_continuous(labels = scales::percent_format())
```

Ciò che è emerso per Londra può dunque essere espanso all'intero territorio nazionale: all'aumentare dei veicoli coinvolti nell'incidente, è più alta la probabilità che sia avvenuto su una strada a doppia corsia.

___

## Giorno della settimana e area urbana/extraurbana

```{r var8, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data_london2014, 
       aes(x = factor(Day_of_Week,
                      levels = c("1", "2", "3", "4", "5", "6", "7"),
                      labels = c("Domenica", "Lunedì", 
                                 "Martedì", "Mercoledì", 
                                 "Giovedì", "Venerdì", "Sabato")),
           fill = factor(Urban_or_Rural_Area, 
                         levels = c("1", "2"),
                         labels = c("Urbana", 
                                    "Extraurbana")))) + 
  geom_bar(position = "fill") +
  scale_y_continuous(breaks = seq(0, 1, .2), 
                     label = percent) +
  scale_fill_brewer(palette = "Set2") +
  labs(y = "", 
       fill = "Urbana/Extraurbana",
       x = "",
       title = "") +
  theme_minimal()
```

Non ci sono grandi differenze tra i giorni della settimana, a parte un minimo aumento dei casi di incidenti su strade extraurbane durante il fine settimana (sabato e domenica). Un'ipotesi potrebbe essere quella delle gite fuori porta / pendolari che terminano la settimana lavorativa/accademica il sabato e rientrano in città la domenica. Cionostante, l'aumento è impercettibile, per cui non viene approfondito.

___

## Condizioni atmosferiche e mese dell'anno

```{r var9, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data_london2014, 
       aes(x = factor(Month, levels = c("1", "2", "3", "4", "5", "6", "7","8","9","10","11","12"),
                      labels = c("Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre")),
           fill = as.factor(Weather_Conditions))) + 
  geom_bar(position = "stack") +
  theme(axis.text.x = element_text(angle = 45, 
                                   hjust = 1)) +
  labs(x="", y = "", title = "", fill = "Meteo") 
```

Si noti che la categoria 'Other' comprende: foschia, nebbia, neve con vento debole, neve con vento forte, etc. Tale informazione spiega perché questa categoria non sia presente tra i mesi estivi.

La maggior parte degli incidenti è avvenuta con condizioni climatiche 'Fine' in tutti i mesi dell'anno. È opportuno ricordare che, come introdotto nelle sezioni precedenti, la categoria 'Fine' includa molte più condizioni atmosferiche rispetto al cielo perfettamente sereno (vento debole, pioggia leggera) purchè non invalidanti all'atto della guida.

A seguire, una mappa ad albero che evidenzia in maniera ancora più eclatante come "Fine" possa potenzialmente racchiudere molte più condizioni atmosferiche rispetto al ciel sereno:

```{r var10, echo=FALSE, message=FALSE, warning=FALSE}
plotdata <- data_london2014 %>%
  count(Weather_Conditions)

ggplot(plotdata, 
       aes(fill = Weather_Conditions, 
           area = n, 
           label = Weather_Conditions)) +
  geom_treemap() + 
  geom_treemap_text(colour = "white", 
                    place = "centre") +
  labs(title = "Incidenti per mese") +
  theme(legend.position = "none")
```

___

## Persone coinvolte, ora e giorno dell'incidente

```{r var11, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data_london2014,
       aes(x = factor(Day_of_Week,
                      levels = c(1,2,3,4,5,6,7),
                      labels= c("Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato")),
          y = Time, size = Number_of_Casualties)) +
  geom_point(alpha = 0.5,
             fill="cornflowerblue",
             color="black",
             shape=21) +
  scale_size_continuous(range = c(1, 14)) +
  labs(title = "",
       x = "",
       y = "Orario dell'incidente")
```

Dal grafico emerge che nei fine settimana, durante le prime ore del mattino, gli incidenti coinvolgano più feriti/vittime. 

___
___

# Confronto tra città

In conclusione all'analisi, vengono prese in considerazione le prime cinque città tra le "largest urban agglomerations" del Regno Unito, per fare un confronto tra di esse. Lo scopo principale è di individuare caratteristiche comuni nell'andamento degli incidenti stradali tra i principali centri urbani britannici.

Precisamente:

* Londra
* Manchester
* Birmingham
* Bradford
* Glasgow

```{r var12, echo=TRUE, message=FALSE, warning=FALSE}
data_manchester <- subset(data, data$Latitude >= 53.4158 & data$Latitude <= 53.5458 & data$Longitude >= -2.3534 & data$Longitude <= -2.1318)
data_birmingham <- subset(data, data$Latitude >= 52.4212 & data$Latitude <= 52.5512 & data$Longitude >= -1.9954 & data$Longitude <= -1.7854) 
data_bradford <- subset(data, data$Latitude >= 53.7310 & data$Latitude <= 53.8610 & data$Longitude >= -1.8644 & data$Longitude <= -1.6544) 
data_glasgow <- subset(data, data$Latitude >= 55.7992 & data$Latitude <= 55.9292 & data$Longitude >= -4.3568 & data$Longitude <= -4.1468) 
```

```{r var13, echo=FALSE, message=FALSE, warning=FALSE}
data_london$City_Name <- "London"
data_london <- data_london %>% relocate(City_Name, .before = "Longitude")

data_manchester$City_Name <- "Manchester"
data_manchester <- data_manchester %>% relocate(City_Name, .before = "Longitude")

data_birmingham$City_Name <- "Birmingham"
data_birmingham <- data_birmingham %>% relocate(City_Name, .before = "Longitude")

data_bradford$City_Name <- "Bradford"
data_bradford <- data_bradford %>% relocate(City_Name, .before = "Longitude")

data_glasgow$City_Name <- "Glasgow"
data_glasgow <- data_glasgow %>% relocate(City_Name, .before = "Longitude")

data_cities <- rbind(data_london, data_manchester, data_birmingham, data_bradford, data_glasgow)

X <- data_cities %>%
  count(City_Name, Year)

plotdata <- spread(X, Year, n)

plotdata <- as.data.frame(plotdata)
row.names(plotdata) <- plotdata$City_Name
plotdata$City_Name <- NULL

#ordinamento
sort.order <- order(plotdata$"2014")

colors <- rev(brewer.pal(5, "Blues"))

superheat(plotdata,
          scale = FALSE,
          left.label.text.size=3,
          bottom.label.text.size=3,
          bottom.label.size = .05,
          heat.pal = colors,
          order.rows = sort.order,
          title = "Incidenti annui nelle 5 città più popolose del Regno Unito")
```

Dal grafico si nota come, per tutte le città ad esclusione di Londra, vi sia un trend decrescente in termini di numero di incidenti negli anni, con un aumento di sinistri nel 2014.

Tenendo a mente ciò che è stato già detto nelle analisi anteriori, sulla città di Londra non emerge la stessa tendenza: di fatto, il numero di incidenti si mantiene piuttosto stabile attraverso gli anni. L'unica similitudine tra Londra e le altre quattro città è appunto questo aumento di incidenti registrato nel 2014 rispetto all'anno precedente.

___
___

# Conclusioni

Nell'analisi dei dati condotta in queste pagine emergono importanti considerazioni e riflessioni. Pur non individuando pattern o tendenze eclatanti, è significativo il fatto che l'analisi abbia contribuito a fornire ipotesi per una maggiore comprensione della complessa dinamica degli incidenti stradali nel Regno Unito. Questo ha portato ad alcune osservazioni che potrebbero essere utili per la pianificazione e l'implementazione di interventi mirati volti a migliorare la sicurezza stradale. 

Infine, la descrizione del dataset con il livello di dettaglio proposto in quest'analisi fornisce un'opportunità per approfondire ulteriormente la ricerca, esplorando altri fattori che avrebbero potuto incidere sulla definizione di strategie di miglioramento. Alcuni esempi potrebbero essere attributi legati strettamente alle condizioni psicofisiche del guidatore al momento dell'incidente, così come informazioni anagrafiche (come età o anni di esperienza alla guida) e/o informazioni sullo specifico veicolo, sia identificative (modello, carrozzeria, cilindrata, tipologia - se a due o quattro ruote, se utilitaria, veicolo commerciale leggero, auto sportiva, autobus, trasporto merci, etc.) che contestuali (velocità al momento dell'impatto, numero di passeggeri, storico degli incidenti del veicolo, etc.).

In conclusione, anche quando i risultati non sono sorprendenti, l'analisi dei dati è comunque uno strumento molto efficace per descrivere fedelmente la realtà e rappresenta un passo importante verso la comprensione di un problema critico e nella ricerca di soluzioni efficaci per migliorare la sicurezza sulle strade.